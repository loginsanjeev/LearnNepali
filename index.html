<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nepali Buddy üéß</title>
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIk5lcGFsaSBCdWRkeSIsCiAgInNob3J0X25hbWUiOiAiTmVwYWxpQnVkZHkiLAogICJkZXNjcmlwdGlvbiI6ICJMZWFybiBOZXBhbGkgbGFuZ3VhZ2Ugd2l0aCBpbnRlcmFjdGl2ZSBsZXNzb25zIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJ0aGVtZV9jb2xvciI6ICIjZmY2YjZiIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjMTIxMjEyIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBuYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNuSUhacFpYZENiM2c5SnpBZ01DQXhNakFnTVRJd0p6NEtQSEpsWTNRZ2QybGtkR2c5SnpFeU1DY2dhR1ZwWjJoMFBTY3hNakFuSUdacGJHdzlKeU5tWmpaaVltUW5MejRLUEhSbGVIUWdlRDBuTmpBbklIazlKelkwSnlCbWFXeHNQU2NqWm1abVptWm1KeUJtYjI1MExYTnBlbVU5SnpJd2NIOG5QRTVGVUVGTVNUD3ZkR1Y0ZEQ0S1BDOXpkbWMrIiwKICAgICAgInNpemVzIjogIjEyMHgxMjAiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      text-align: center; 
      padding: 20px; 
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #ffffff; 
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .container {
      max-width: 400px;
      margin: 0 auto;
      flex: 1;
    }
    
    h1 { 
      color: #ff6b6b; 
      margin-bottom: 10px;
      font-size: 2rem;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .stats {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
      background: rgba(255,255,255,0.1);
      padding: 15px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }
    
    .stat {
      text-align: center;
    }
    
    .stat-number {
      font-size: 1.5rem;
      font-weight: bold;
      color: #feca57;
    }
    
    .stat-label {
      font-size: 0.8rem;
      opacity: 0.8;
    }
    
    .module-tabs {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }
    
    .module-btn {
      flex: 1;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 16px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(255,255,255,0.1);
      color: white;
    }
    
    .module-btn.active {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: #000;
      border-color: #fff;
    }
    
    .word-card {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 20px;
      margin: 20px 0;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    
    .word-display {
      font-size: 1.8rem;
      margin-bottom: 15px;
      min-height: 60px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .nepali-text {
      font-size: 2.2rem;
      margin-bottom: 5px;
    }
    
    .roman-text {
      font-size: 1.2rem;
      opacity: 0.8;
    }
    
    .listen-btn {
      width: 80px;
      height: 80px;
      font-size: 24px;
      border-radius: 50%;
      margin: 15px auto;
      background: linear-gradient(135deg, #1dd1a1, #54a0ff);
      color: #fff;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    
    .listen-btn:active {
      transform: scale(0.95);
    }
    
    .listen-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .options-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin: 20px 0;
    }
    
    .option-card {
      padding: 20px;
      border-radius: 15px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      cursor: pointer;
      font-size: 16px;
      color: #fff;
      border: 2px solid transparent;
      transition: all 0.3s ease;
      min-height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .option-card:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-2px);
    }
    
    .option-card:active {
      transform: scale(0.95);
    }
    
    .option-card.correct {
      border-color: #1dd1a1;
      background: rgba(29, 209, 161, 0.2);
    }
    
    .option-card.incorrect {
      border-color: #ff6b6b;
      background: rgba(255, 107, 107, 0.2);
    }
    
    .feedback {
      font-size: 18px;
      margin: 15px 0;
      min-height: 25px;
      font-weight: bold;
    }
    
    .speaking-controls {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    
    .speaking-controls.active {
      display: flex;
    }
    
    .record-btn {
      width: 100px;
      height: 100px;
      font-size: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: #000;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    
    .record-btn.recording {
      animation: pulse 1s infinite;
      background: linear-gradient(135deg, #ff4757, #ff3838);
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      overflow: hidden;
      margin: 20px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(135deg, #1dd1a1, #54a0ff);
      width: 0%;
      transition: width 0.3s ease;
    }
    
    .skip-btn {
      background: rgba(255,255,255,0.1);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.3);
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      margin: 10px;
      transition: all 0.3s ease;
    }
    
    .skip-btn:hover {
      background: rgba(255,255,255,0.2);
    }
    
    .fallback-message {
      background: rgba(255, 193, 7, 0.2);
      border: 1px solid #ffc107;
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
      font-size: 14px;
    }
    
    .hidden { display: none !important; }
    
    @media (max-width: 480px) {
      .container { padding: 10px; }
      h1 { font-size: 1.5rem; }
      .word-display { font-size: 1.4rem; }
      .nepali-text { font-size: 1.8rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Nepali Buddy üéß</h1>
    
    <div class="stats">
      <div class="stat">
        <div class="stat-number" id="streak">0</div>
        <div class="stat-label">Day Streak</div>
      </div>
      <div class="stat">
        <div class="stat-number" id="totalLearned">0</div>
        <div class="stat-label">Words Learned</div>
      </div>
      <div class="stat">
        <div class="stat-number" id="accuracy">0%</div>
        <div class="stat-label">Accuracy</div>
      </div>
    </div>

    <div class="module-tabs">
      <button class="module-btn active" onclick="setModule('reading')">üìñ Reading</button>
      <button class="module-btn" onclick="setModule('speaking')">üé§ Speaking</button>
    </div>

    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <div class="word-card">
      <div class="word-display" id="wordDisplay">
        <div class="nepali-text" id="nepaliText">Loading...</div>
        <div class="roman-text" id="romanText"></div>
      </div>
      
      <button class="listen-btn" id="listenBtn" title="Listen to pronunciation">üîä</button>
      
      <div class="options-grid" id="optionsGrid"></div>
      
      <div class="speaking-controls" id="speakingControls">
        <div id="fallbackMessage" class="fallback-message hidden">
          Speech recognition is not available in your browser. Please try Chrome or Edge for the best experience.
        </div>
        <button class="record-btn" id="recordBtn" title="Record your pronunciation">üé§</button>
        <div style="text-align: center; margin-top: 10px;">
          <div>üéß <strong>First:</strong> Listen to the pronunciation</div>
          <div style="margin-top: 5px;">üé§ <strong>Then:</strong> Hold the mic button and speak</div>
          <div style="font-size: 0.9em; opacity: 0.8; margin-top: 10px;">
            <em>Practice mode works in all browsers!</em>
          </div>
        </div>
      </div>
      
      <div class="feedback" id="feedback"></div>
      
      <button class="skip-btn" id="skipBtn" onclick="skipWord()">Skip Word</button>
    </div>
  </div>

  <script>
    // Complete 500-word Nepali vocabulary dataset
    const words = [
      // Greetings & Basic Phrases
      { nepali: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á", roman: "Namaste", english: "Hello" },
      { nepali: "‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶", roman: "Dhanyabad", english: "Thank you" },
      { nepali: "‡§Æ‡§æ‡§´ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç", roman: "Maaf garnuhos", english: "Sorry" },
      { nepali: "‡§´‡•á‡§∞‡§ø ‡§≠‡•á‡§ü‡•å‡§Ç", roman: "Pheri bhetaun", english: "See you again" },
      { nepali: "‡§∂‡•Å‡§≠ ‡§∞‡§æ‡§§‡•ç‡§∞‡•Ä", roman: "Shubha ratri", english: "Good night" },
      { nepali: "‡§∂‡•Å‡§≠ ‡§¨‡§ø‡§π‡§æ‡§®", roman: "Shubha bihan", english: "Good morning" },
      { nepali: "‡§ï‡§∏‡•ç‡§§‡•ã ‡§õ", roman: "Kasto cha", english: "How are you" },
      { nepali: "‡§†‡§ø‡§ï ‡§õ", roman: "Thik cha", english: "It's okay" },
      { nepali: "‡§π‡•Å‡§®‡•ç‡§õ", roman: "Huncha", english: "Okay/Alright" },
      { nepali: "‡§¨‡•Å‡§ù‡§ø‡§®", roman: "Bujhina", english: "I don't understand" },

      // Numbers 1-20
      { nepali: "‡§è‡§ï", roman: "Ek", english: "One" },
      { nepali: "‡§¶‡•Å‡§à", roman: "Dui", english: "Two" },
      { nepali: "‡§§‡•Ä‡§®", roman: "Teen", english: "Three" },
      { nepali: "‡§ö‡§æ‡§∞", roman: "Char", english: "Four" },
      { nepali: "‡§™‡§æ‡§Å‡§ö", roman: "Panch", english: "Five" },
      { nepali: "‡§õ", roman: "Chha", english: "Six" },
      { nepali: "‡§∏‡§æ‡§§", roman: "Saat", english: "Seven" },
      { nepali: "‡§Ü‡§†", roman: "Aath", english: "Eight" },
      { nepali: "‡§®‡•å", roman: "Nau", english: "Nine" },
      { nepali: "‡§¶‡§∏", roman: "Das", english: "Ten" },
      { nepali: "‡§è‡§ò‡§æ‡§∞", roman: "Eghar", english: "Eleven" },
      { nepali: "‡§¨‡§æ‡§π‡•ç‡§∞", roman: "Bahra", english: "Twelve" },
      { nepali: "‡§§‡•á‡§π‡•ç‡§∞", roman: "Tehra", english: "Thirteen" },
      { nepali: "‡§ö‡•å‡§ß", roman: "Chaudha", english: "Fourteen" },
      { nepali: "‡§™‡§®‡•ç‡§ß‡•ç‡§∞", roman: "Pandhra", english: "Fifteen" },
      { nepali: "‡§∏‡•ã‡§π‡•ç‡§∞", roman: "Sohra", english: "Sixteen" },
      { nepali: "‡§∏‡§§‡•ç‡§∞", roman: "Satra", english: "Seventeen" },
      { nepali: "‡§Ö‡§†‡§æ‡§∞", roman: "Athara", english: "Eighteen" },
      { nepali: "‡§â‡§®‡•ç‡§®‡§æ‡§á‡§∏", roman: "Unnaais", english: "Nineteen" },
      { nepali: "‡§¨‡•Ä‡§∏", roman: "Bees", english: "Twenty" },

      // Family Members
      { nepali: "‡§Ü‡§Æ‡§æ", roman: "Aama", english: "Mother" },
      { nepali: "‡§¨‡•Å‡§µ‡§æ", roman: "Buwa", english: "Father" },
      { nepali: "‡§¶‡§æ‡§ú‡•Å", roman: "Daju", english: "Elder brother" },
      { nepali: "‡§≠‡§æ‡§á", roman: "Bhai", english: "Younger brother" },
      { nepali: "‡§¶‡§ø‡§¶‡•Ä", roman: "Didi", english: "Elder sister" },
      { nepali: "‡§¨‡§π‡§ø‡§®‡•Ä", roman: "Bahini", english: "Younger sister" },
      { nepali: "‡§π‡§ú‡•Å‡§∞‡§Ü‡§Æ‡§æ", roman: "Hajuraama", english: "Grandmother" },
      { nepali: "‡§π‡§ú‡•Å‡§∞‡§¨‡•Å‡§µ‡§æ", roman: "Hajurbuwa", english: "Grandfather" },
      { nepali: "‡§õ‡•ã‡§∞‡§æ", roman: "Chhora", english: "Son" },
      { nepali: "‡§õ‡•ã‡§∞‡•Ä", roman: "Chhori", english: "Daughter" },

      // Body Parts
      { nepali: "‡§ü‡§æ‡§â‡§ï‡•ã", roman: "Tauko", english: "Head" },
      { nepali: "‡§Ü‡§Å‡§ñ‡§æ", roman: "Aankha", english: "Eyes" },
      { nepali: "‡§®‡§æ‡§ï", roman: "Naak", english: "Nose" },
      { nepali: "‡§Æ‡•Å‡§ñ", roman: "Mukh", english: "Mouth" },
      { nepali: "‡§ï‡§æ‡§®", roman: "Kaan", english: "Ear" },
      { nepali: "‡§π‡§æ‡§§", roman: "Haat", english: "Hand" },
      { nepali: "‡§ñ‡•Å‡§ü‡•ç‡§ü‡§æ", roman: "Khutta", english: "Leg" },
      { nepali: "‡§î‡§Ç‡§≤‡§æ", roman: "Aunla", english: "Finger" },
      { nepali: "‡§™‡•á‡§ü", roman: "Pet", english: "Stomach" },
      { nepali: "‡§Æ‡•Å‡§ü‡•Å", roman: "Mutu", english: "Heart" },

      // Colors
      { nepali: "‡§∞‡§æ‡§§‡•ã", roman: "Raato", english: "Red" },
      { nepali: "‡§®‡§ø‡§≤‡•ã", roman: "Nilo", english: "Blue" },
      { nepali: "‡§π‡§∞‡§ø‡§Ø‡•ã", roman: "Hariyo", english: "Green" },
      { nepali: "‡§™‡§π‡•á‡§Ç‡§≤‡•ã", roman: "Pahelo", english: "Yellow" },
      { nepali: "‡§ï‡§æ‡§≤‡•ã", roman: "Kaalo", english: "Black" },
      { nepali: "‡§∏‡•á‡§§‡•ã", roman: "Seto", english: "White" },
      { nepali: "‡§ñ‡•à‡§∞‡•ã", roman: "Khairo", english: "Brown" },
      { nepali: "‡§ó‡•Å‡§≤‡§æ‡§¨‡•Ä", roman: "Gulaabi", english: "Pink" },
      { nepali: "‡§¨‡•à‡§ú‡§®‡•Ä", roman: "Baijani", english: "Purple" },
      { nepali: "‡§∏‡•Å‡§®‡•ç‡§§‡§≤‡§æ", roman: "Suntala", english: "Orange" },

      // Animals
      { nepali: "‡§ï‡•Å‡§ï‡•Å‡§∞", roman: "Kukur", english: "Dog" },
      { nepali: "‡§¨‡§ø‡§∞‡§æ‡§≤‡•ã", roman: "Biralo", english: "Cat" },
      { nepali: "‡§ó‡§æ‡§à", roman: "Gaai", english: "Cow" },
      { nepali: "‡§≠‡•à‡§Ç‡§∏‡•Ä", roman: "Bhainsi", english: "Buffalo" },
      { nepali: "‡§¨‡§æ‡§ñ‡•ç‡§∞‡§æ", roman: "Bakhra", english: "Goat" },
      { nepali: "‡§∏‡•Å‡§Ç‡§ó‡•Å‡§∞", roman: "Sungur", english: "Pig" },
      { nepali: "‡§ï‡•Å‡§ñ‡•Å‡§∞‡§æ", roman: "Kukhura", english: "Chicken" },
      { nepali: "‡§ö‡§∞‡§æ", roman: "Chara", english: "Bird" },
      { nepali: "‡§Æ‡§æ‡§õ‡§æ", roman: "Machha", english: "Fish" },
      { nepali: "‡§π‡§æ‡§§‡•ç‡§§‡•Ä", roman: "Haatti", english: "Elephant" },

      // Food & Drinks
      { nepali: "‡§ñ‡§æ‡§®‡§æ", roman: "Khana", english: "Food" },
      { nepali: "‡§™‡§æ‡§®‡•Ä", roman: "Pani", english: "Water" },
      { nepali: "‡§¶‡•Ç‡§ß", roman: "Dudh", english: "Milk" },
      { nepali: "‡§≠‡§æ‡§§", roman: "Bhaat", english: "Rice" },
      { nepali: "‡§¶‡§æ‡§≤", roman: "Daal", english: "Lentils" },
      { nepali: "‡§§‡§∞‡§ï‡§æ‡§∞‡•Ä", roman: "Tarkaari", english: "Vegetables" },
      { nepali: "‡§Æ‡§æ‡§∏‡•Å", roman: "Maasu", english: "Meat" },
      { nepali: "‡§´‡§≤‡§´‡•Ç‡§≤", roman: "Phalphul", english: "Fruits" },
      { nepali: "‡§∞‡•ã‡§ü‡•Ä", roman: "Roti", english: "Bread" },
      { nepali: "‡§ö‡§ø‡§Ø‡§æ", roman: "Chiya", english: "Tea" },

      // House & Objects
      { nepali: "‡§ò‡§∞", roman: "Ghar", english: "House" },
      { nepali: "‡§ï‡•ã‡§†‡§æ", roman: "Kotha", english: "Room" },
      { nepali: "‡§¢‡•ã‡§ï‡§æ", roman: "Dhoka", english: "Door" },
      { nepali: "‡§ù‡•ç‡§Ø‡§æ‡§≤", roman: "Jhyaal", english: "Window" },
      { nepali: "‡§ì‡§õ‡•ç‡§Ø‡§æ‡§®", roman: "Ochhyaan", english: "Bed" },
      { nepali: "‡§ü‡•á‡§¨‡•Å‡§≤", roman: "Tebul", english: "Table" },
      { nepali: "‡§ï‡•Å‡§∞‡•ç‡§∏‡•Ä", roman: "Kursi", english: "Chair" },
      { nepali: "‡§ï‡§ø‡§§‡§æ‡§¨", roman: "Kitaab", english: "Book" },
      { nepali: "‡§ï‡§≤‡§Æ", roman: "Kalam", english: "Pen" },
      { nepali: "‡§ï‡§æ‡§ó‡§ú", roman: "Kaagaj", english: "Paper" },

      // Nature & Weather
      { nepali: "‡§∏‡•Ç‡§∞‡•ç‡§Ø", roman: "Surya", english: "Sun" },
      { nepali: "‡§ö‡§®‡•ç‡§¶‡•ç‡§∞‡§Æ‡§æ", roman: "Chandrma", english: "Moon" },
      { nepali: "‡§§‡§æ‡§∞‡§æ", roman: "Taara", english: "Star" },
      { nepali: "‡§™‡§æ‡§®‡•Ä ‡§™‡§∞‡•ç‡§®‡•á", roman: "Paani parne", english: "Rain" },
      { nepali: "‡§π‡§æ‡§µ‡§æ", roman: "Haawa", english: "Wind" },
      { nepali: "‡§π‡§ø‡§â‡§Å", roman: "Hiun", english: "Snow" },
      { nepali: "‡§Ü‡§ó‡•ã", roman: "Aago", english: "Fire" },
      { nepali: "‡§Æ‡§æ‡§ü‡•ã", roman: "Maato", english: "Soil" },
      { nepali: "‡§∞‡•Å‡§ñ", roman: "Rukh", english: "Tree" },
      { nepali: "‡§´‡•Ç‡§≤", roman: "Phul", english: "Flower" },

      // Transportation
      { nepali: "‡§¨‡§∏", roman: "Bus", english: "Bus" },
      { nepali: "‡§ó‡§æ‡§°‡•Ä", roman: "Gaadi", english: "Car" },
      { nepali: "‡§Æ‡•ã‡§ü‡§∞‡§∏‡§æ‡§á‡§ï‡§≤", roman: "Motorsaikl", english: "Motorcycle" },
      { nepali: "‡§∏‡§æ‡§á‡§ï‡§≤", roman: "Saikl", english: "Bicycle" },
      { nepali: "‡§ú‡§π‡§æ‡§ú", roman: "Jahaaj", english: "Airplane" },
      { nepali: "‡§∞‡•á‡§≤", roman: "Rel", english: "Train" },
      { nepali: "‡§°‡•Å‡§Ç‡§ó‡§æ", roman: "Dunga", english: "Boat" },
      { nepali: "‡§ü‡•ç‡§Ø‡§æ‡§ï‡•ç‡§∏‡•Ä", roman: "Tyaksi", english: "Taxi" },
      { nepali: "‡§∞‡§ø‡§ï‡•ç‡§∏‡§æ", roman: "Riksa", english: "Rickshaw" },
      { nepali: "‡§∏‡§°‡§ï", roman: "Sadak", english: "Road" },

      // Time & Days
      { nepali: "‡§∏‡§Æ‡§Ø", roman: "Samay", english: "Time" },
      { nepali: "‡§¶‡§ø‡§®", roman: "Din", english: "Day" },
      { nepali: "‡§∞‡§æ‡§§", roman: "Raat", english: "Night" },
      { nepali: "‡§¨‡§ø‡§π‡§æ‡§®", roman: "Bihaan", english: "Morning" },
      { nepali: "‡§¶‡§ø‡§â‡§Å‡§∏‡•ã", roman: "Diunso", english: "Afternoon" },
      { nepali: "‡§∏‡§æ‡§Å‡§ù", roman: "Saanjh", english: "Evening" },
      { nepali: "‡§Ü‡§á‡§§‡§¨‡§æ‡§∞", roman: "Aitabaar", english: "Sunday" },
      { nepali: "‡§∏‡•ã‡§Æ‡§¨‡§æ‡§∞", roman: "Sombaar", english: "Monday" },
      { nepali: "‡§Æ‡§Ç‡§ó‡§≤‡§¨‡§æ‡§∞", roman: "Mangalbaar", english: "Tuesday" },
      { nepali: "‡§¨‡•Å‡§ß‡§¨‡§æ‡§∞", roman: "Budhabaar", english: "Wednesday" },
      { nepali: "‡§¨‡§ø‡§π‡•Ä‡§¨‡§æ‡§∞", roman: "Bihibaar", english: "Thursday" },
      { nepali: "‡§∂‡•Å‡§ï‡•ç‡§∞‡§¨‡§æ‡§∞", roman: "Shukrabaar", english: "Friday" },
      { nepali: "‡§∂‡§®‡§ø‡§¨‡§æ‡§∞", roman: "Shanibaar", english: "Saturday" },

      // Common Verbs
      { nepali: "‡§ú‡§æ‡§®‡•Å", roman: "Jaanu", english: "To go" },
      { nepali: "‡§Ü‡§â‡§®‡•Å", roman: "Aaunu", english: "To come" },
      { nepali: "‡§ñ‡§æ‡§®‡•Å", roman: "Khaanu", english: "To eat" },
      { nepali: "‡§™‡§ø‡§â‡§®‡•Å", roman: "Piunu", english: "To drink" },
      { nepali: "‡§∏‡•Å‡§§‡•ç‡§®‡•Å", roman: "Sutnu", english: "To sleep" },
      { nepali: "‡§â‡§†‡•ç‡§®‡•Å", roman: "Uthnu", english: "To wake up" },
      { nepali: "‡§¨‡§∏‡•ç‡§®‡•Å", roman: "Basnu", english: "To sit" },
      { nepali: "‡§â‡§≠‡§ø‡§®‡•Å", roman: "Ubhinu", english: "To stand" },
      { nepali: "‡§π‡•á‡§∞‡•ç‡§®‡•Å", roman: "Hernu", english: "To see" },
      { nepali: "‡§∏‡•Å‡§®‡•ç‡§®‡•Å", roman: "Sunnu", english: "To hear" },

      // Common Adjectives
      { nepali: "‡§†‡•Ç‡§≤‡•ã", roman: "Thulo", english: "Big" },
      { nepali: "‡§∏‡§æ‡§®‡•ã", roman: "Sano", english: "Small" },
      { nepali: "‡§≤‡§æ‡§Æ‡•ã", roman: "Laamo", english: "Long" },
      { nepali: "‡§õ‡•ã‡§ü‡•ã", roman: "Chhoto", english: "Short" },
      { nepali: "‡§∞‡§æ‡§Æ‡•ç‡§∞‡•ã", roman: "Ramro", english: "Good" },
      { nepali: "‡§®‡§∞‡§æ‡§Æ‡•ç‡§∞‡•ã", roman: "Naramro", english: "Bad" },
      { nepali: "‡§§‡§æ‡§§‡•ã", roman: "Taato", english: "Hot" },
      { nepali: "‡§ö‡§ø‡§∏‡•ã", roman: "Chiso", english: "Cold" },
      { nepali: "‡§®‡§Ø‡§æ‡§Å", roman: "Nayan", english: "New" },
      { nepali: "‡§™‡•Å‡§∞‡§æ‡§®‡•ã", roman: "Puraano", english: "Old" },

      // Directions & Places
      { nepali: "‡§â‡§§‡•ç‡§§‡§∞", roman: "Uttar", english: "North" },
      { nepali: "‡§¶‡§ï‡•ç‡§∑‡§ø‡§£", roman: "Dakshin", english: "South" },
      { nepali: "‡§™‡•Ç‡§∞‡•ç‡§µ", roman: "Purva", english: "East" },
      { nepali: "‡§™‡§∂‡•ç‡§ö‡§ø‡§Æ", roman: "Pashchim", english: "West" },
      { nepali: "‡§Æ‡§æ‡§•‡§ø", roman: "Maathi", english: "Up" },
      { nepali: "‡§§‡§≤", roman: "Tala", english: "Down" },
      { nepali: "‡§Ö‡§ó‡§æ‡§°‡§ø", roman: "Agaadi", english: "Front" },
      { nepali: "‡§™‡§õ‡§æ‡§°‡§ø", roman: "Pachhaadi", english: "Behind" },
      { nepali: "‡§≠‡§ø‡§§‡•ç‡§∞", roman: "Bhitra", english: "Inside" },
      { nepali: "‡§¨‡§æ‡§π‡§ø‡§∞", roman: "Baahira", english: "Outside" },

      // School & Education
      { nepali: "‡§∏‡•ç‡§ï‡•Ç‡§≤", roman: "Skul", english: "School" },
      { nepali: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä", roman: "Vidyaarthi", english: "Student" },
      { nepali: "‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï", roman: "Shikshak", english: "Teacher" },
      { nepali: "‡§™‡§¢‡•ç‡§®‡•Å", roman: "Padhnu", english: "To read" },
      { nepali: "‡§≤‡•á‡§ñ‡•ç‡§®‡•Å", roman: "Lekhnu", english: "To write" },
      { nepali: "‡§ó‡§£‡§ø‡§§", roman: "Ganit", english: "Mathematics" },
      { nepali: "‡§≠‡§æ‡§∑‡§æ", roman: "Bhaasha", english: "Language" },
      { nepali: "‡§á‡§§‡§ø‡§π‡§æ‡§∏", roman: "Itihaas", english: "History" },
      { nepali: "‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®", roman: "Vigyan", english: "Science" },
      { nepali: "‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ", roman: "Parikshaa", english: "Exam" },

      // Health & Body
      { nepali: "‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø", roman: "Swaasthya", english: "Health" },
      { nepali: "‡§¨‡§ø‡§∞‡§æ‡§Æ‡•Ä", roman: "Biraami", english: "Sick" },
      { nepali: "‡§°‡§æ‡§ï‡•ç‡§ü‡§∞", roman: "Daaktar", english: "Doctor" },
      { nepali: "‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤", roman: "Aspataal", english: "Hospital" },
      { nepali: "‡§î‡§∑‡§ß‡§ø", roman: "Aushadhi", english: "Medicine" },
      { nepali: "‡§¶‡•Å‡§ñ‡•ç‡§®‡•Å", roman: "Dukhnu", english: "To hurt" },
      { nepali: "‡§®‡§ø‡§ï‡•ã ‡§π‡•Å‡§®‡•Å", roman: "Niko hunu", english: "To recover" },
      { nepali: "‡§ñ‡•ã‡§ï‡•Ä", roman: "Khoki", english: "Cough" },
      { nepali: "‡§ú‡•ç‡§µ‡§∞‡•ã", roman: "Jwaro", english: "Fever" },
      { nepali: "‡§ü‡§æ‡§â‡§ï‡•ã ‡§¶‡•Å‡§ñ‡•ç‡§®‡•Å", roman: "Tauko dukhnu", english: "Headache" },

      // Work & Professions
      { nepali: "‡§ï‡§æ‡§Æ", roman: "Kaam", english: "Work" },
      { nepali: "‡§®‡•ã‡§ï‡§∞‡•Ä", roman: "Nokari", english: "Job" },
      { nepali: "‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞‡•Ä", roman: "Vyaapaari", english: "Businessman" },
      { nepali: "‡§ï‡§ø‡§∏‡§æ‡§®", roman: "Kisaan", english: "Farmer" },
      { nepali: "‡§á‡§®‡•ç‡§ú‡§ø‡§®‡§ø‡§Ø‡§∞", roman: "Engineer", english: "Engineer" },
      { nepali: "‡§®‡§∞‡•ç‡§∏", roman: "Nurse", english: "Nurse" },
      { nepali: "‡§™‡•Å‡§≤‡§ø‡§∏", roman: "Pulis", english: "Police" },
      { nepali: "‡§°‡•ç‡§∞‡§æ‡§á‡§≠‡§∞", roman: "Driver", english: "Driver" },
      { nepali: "‡§¶‡§∞‡•ç‡§ú‡•Ä", roman: "Darji", english: "Tailor" },
      { nepali: "‡§®‡§æ‡§à", roman: "Naai", english: "Barber" },

      // Money & Shopping
      { nepali: "‡§™‡•à‡§∏‡§æ", roman: "Paisa", english: "Money" },
      { nepali: "‡§ï‡§ø‡§®‡•ç‡§®‡•Å", roman: "Kinnu", english: "To buy" },
      { nepali: "‡§¨‡•á‡§ö‡•ç‡§®‡•Å", roman: "Bechnu", english: "To sell" },
      { nepali: "‡§™‡§∏‡§≤", roman: "Pasal", english: "Shop" },
      { nepali: "‡§¨‡§ú‡§æ‡§∞", roman: "Bajaar", english: "Market" },
      { nepali: "‡§Æ‡§π‡§Ç‡§ó‡•ã", roman: "Mahango", english: "Expensive" },
      { nepali: "‡§∏‡§∏‡•ç‡§§‡•ã", roman: "Sasto", english: "Cheap" },
      { nepali: "‡§Æ‡•Ç‡§≤‡•ç‡§Ø", roman: "Mulya", english: "Price" },
      { nepali: "‡§∞‡•Å‡§™‡•à‡§Ø‡§æ", roman: "Rupaiya", english: "Rupee" },
      { nepali: "‡§õ‡•Å‡§ü‡•ç‡§ü‡•ã ‡§™‡•à‡§∏‡§æ", roman: "Chutto paisa", english: "Change money" },

      // Clothing
      { nepali: "‡§≤‡•Å‡§ó‡§æ", roman: "Luga", english: "Clothes" },
      { nepali: "‡§∂‡§∞‡•ç‡§ü", roman: "Shirt", english: "Shirt" },
      { nepali: "‡§™‡•à‡§Ç‡§ü", roman: "Pant", english: "Pants" },
      { nepali: "‡§ú‡•Å‡§§‡•ç‡§§‡§æ", roman: "Jutta", english: "Shoes" },
      { nepali: "‡§Æ‡•ã‡§ú‡§æ", roman: "Moja", english: "Socks" },
      { nepali: "‡§ü‡•ã‡§™‡•Ä", roman: "Topi", english: "Hat" },
      { nepali: "‡§ï‡•ã‡§ü", roman: "Kot", english: "Coat" },
      { nepali: "‡§∏‡•ç‡§ï‡§∞‡•ç‡§ü", roman: "Skirt", english: "Skirt" },
      { nepali: "‡§∏‡§æ‡§°‡•Ä", roman: "Saadi", english: "Sari" },
      { nepali: "‡§ó‡§π‡§®‡§æ", roman: "Gahanaa", english: "Jewelry" },

      // Technology
      { nepali: "‡§´‡•ã‡§®", roman: "Phone", english: "Phone" },
      { nepali: "‡§ï‡§Æ‡•ç‡§™‡•ç‡§Ø‡•Å‡§ü‡§∞", roman: "Computer", english: "Computer" },
      { nepali: "‡§á‡§®‡•ç‡§ü‡§∞‡§®‡•á‡§ü", roman: "Internet", english: "Internet" },
      { nepali: "‡§ü‡•á‡§≤‡§ø‡§≠‡§ø‡§ú‡§®", roman: "Television", english: "Television" },
      { nepali: "‡§∞‡•á‡§°‡§ø‡§Ø‡•ã", roman: "Radio", english: "Radio" },
      { nepali: "‡§ï‡•ç‡§Ø‡§æ‡§Æ‡•á‡§∞‡§æ", roman: "Camera", english: "Camera" },
      { nepali: "‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤", roman: "Mobile", english: "Mobile" },
      { nepali: "‡§¨‡§ø‡§ú‡•Å‡§≤‡•Ä", roman: "Bijuli", english: "Electricity" },
      { nepali: "‡§¨‡§§‡•ç‡§§‡•Ä", roman: "Batti", english: "Light" },
      { nepali: "‡§™‡§Ç‡§ñ‡§æ", roman: "Pankha", english: "Fan" },

      // Emotions & Feelings
      { nepali: "‡§ñ‡•Å‡§∂‡•Ä", roman: "Khushi", english: "Happy" },
      { nepali: "‡§¶‡•Å‡§É‡§ñ‡•Ä", roman: "Dukhi", english: "Sad" },
      { nepali: "‡§∞‡§ø‡§∏‡§æ‡§â‡§®‡•Å", roman: "Risaaunu", english: "To be angry" },
      { nepali: "‡§°‡§∞‡§æ‡§â‡§®‡•Å", roman: "Daraaunu", english: "To be scared" },
      { nepali: "‡§Æ‡§æ‡§Ø‡§æ", roman: "Maya", english: "Love" },
      { nepali: "‡§ò‡•É‡§£‡§æ", roman: "Ghrina", english: "Hate" },
      { nepali: "‡§ö‡§ø‡§®‡•ç‡§§‡§æ", roman: "Chinta", english: "Worry" },
      { nepali: "‡§Ü‡§∂‡§æ", roman: "Aasha", english: "Hope" },
      { nepali: "‡§ó‡§∞‡•ç‡§µ", roman: "Garva", english: "Pride" },
      { nepali: "‡§≤‡§ú‡•ç‡§ú‡§æ", roman: "Lajjaa", english: "Shame" },

      // Sports & Games
      { nepali: "‡§ñ‡•á‡§≤", roman: "Khel", english: "Game/Sport" },
      { nepali: "‡§´‡•Å‡§ü‡§¨‡§≤", roman: "Football", english: "Football" },
      { nepali: "‡§ï‡•ç‡§∞‡§ø‡§ï‡•á‡§ü", roman: "Cricket", english: "Cricket" },
      { nepali: "‡§≠‡§≤‡§ø‡§¨‡§≤", roman: "Volleyball", english: "Volleyball" },
      { nepali: "‡§¨‡§æ‡§∏‡•ç‡§ï‡•á‡§ü‡§¨‡§≤", roman: "Basketball", english: "Basketball" },
      { nepali: "‡§¶‡•å‡§°‡§®‡•Å", roman: "Daudanu", english: "To run" },
      { nepali: "‡§â‡§´‡•ç‡§∞‡§®‡•Å", roman: "Uphranu", english: "To jump" },
      { nepali: "‡§™‡•å‡§°‡•Ä ‡§ñ‡•á‡§≤‡•ç‡§®‡•Å", roman: "Paudi khelnu", english: "Swimming" },
      { nepali: "‡§®‡§æ‡§ö‡•ç‡§®‡•Å", roman: "Nachnu", english: "To dance" },
      { nepali: "‡§ó‡§æ‡§â‡§®‡•Å", roman: "Gaaunu", english: "To sing" },

      // Religion & Culture
      { nepali: "‡§≠‡§ó‡§µ‡§æ‡§®", roman: "Bhagwan", english: "God" },
      { nepali: "‡§Æ‡§®‡•ç‡§¶‡§ø‡§∞", roman: "Mandir", english: "Temple" },
      { nepali: "‡§™‡•Ç‡§ú‡§æ", roman: "Puja", english: "Worship" },
      { nepali: "‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞", roman: "Tyohar", english: "Festival" },
      { nepali: "‡§¶‡§∂‡•à‡§Ç", roman: "Dashain", english: "Dashain" },
      { nepali: "‡§§‡§ø‡§π‡§æ‡§∞", roman: "Tihar", english: "Tihar" },
      { nepali: "‡§π‡•ã‡§≤‡•Ä", roman: "Holi", english: "Holi" },
      { nepali: "‡§ú‡§æ‡§§‡•ç‡§∞‡§æ", roman: "Jaatra", english: "Festival procession" },
      { nepali: "‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø", roman: "Sanskriti", english: "Culture" },
      { nepali: "‡§™‡§∞‡§Æ‡•ç‡§™‡§∞‡§æ", roman: "Parampara", english: "Tradition" },

      // Geography
      { nepali: "‡§®‡•á‡§™‡§æ‡§≤", roman: "Nepal", english: "Nepal" },
      { nepali: "‡§ï‡§æ‡§†‡§Æ‡§æ‡§°‡•å‡§Ç", roman: "Kathmandu", english: "Kathmandu" },
      { nepali: "‡§™‡§π‡§æ‡§°", roman: "Pahaad", english: "Mountain" },
      { nepali: "‡§®‡§¶‡•Ä", roman: "Nadi", english: "River" },
      { nepali: "‡§§‡§æ‡§≤‡•ã", roman: "Taalo", english: "Lake" },
      { nepali: "‡§ú‡§Ç‡§ó‡§≤", roman: "Jangal", english: "Forest" },
      { nepali: "‡§ó‡§æ‡§â‡§Å", roman: "Gaun", english: "Village" },
      { nepali: "‡§∂‡§π‡§∞", roman: "Shahar", english: "City" },
      { nepali: "‡§¶‡•á‡§∂", roman: "Desh", english: "Country" },
      { nepali: "‡§∏‡§Ç‡§∏‡§æ‡§∞", roman: "Sansaar", english: "World" },

      // Additional Common Words
      { nepali: "‡§π‡•ã", roman: "Ho", english: "Yes" },
      { nepali: "‡§π‡•ã‡§á‡§®", roman: "Hoina", english: "No" },
      { nepali: "‡§ï‡•á", roman: "Ke", english: "What" },
      { nepali: "‡§ï‡§π‡§æ‡§Å", roman: "Kahan", english: "Where" },
      { nepali: "‡§ï‡§π‡§ø‡§≤‡•á", roman: "Kahile", english: "When" },
      { nepali: "‡§ï‡§ø‡§®", roman: "Kina", english: "Why" },
      { nepali: "‡§ï‡§∏‡§∞‡•Ä", roman: "Kasari", english: "How" },
      { nepali: "‡§ï‡•ã", roman: "Ko", english: "Who" },
      { nepali: "‡§ï‡§§‡§ø", roman: "Kati", english: "How much" },
      { nepali: "‡§Ø‡§π‡§æ‡§Å", roman: "Yahan", english: "Here" },
      { nepali: "‡§§‡•ç‡§Ø‡§π‡§æ‡§Å", roman: "Tyahan", english: "There" },
      { nepali: "‡§Ö‡§¨", roman: "Aba", english: "Now" },
      { nepali: "‡§§‡•ç‡§Ø‡§∏‡§™‡§õ‡§ø", roman: "Tyaspachhi", english: "Then" },
      { nepali: "‡§∏‡§ß‡•à‡§Ç", roman: "Sadhain", english: "Always" },
      { nepali: "‡§ï‡§π‡§ø‡§≤‡•ç‡§Ø‡•à", roman: "Kahilyai", english: "Never" },
      { nepali: "‡§¨‡•á‡§≤‡•Å‡§ï‡§æ", roman: "Beluka", english: "Evening time" },
      { nepali: "‡§Æ‡§ß‡•ç‡§Ø‡§∞‡§æ‡§§", roman: "Madhyaraat", english: "Midnight" },
      { nepali: "‡§¨‡§ø‡§∏‡•ç‡§§‡§æ‡§∞‡•à", roman: "Bistaarai", english: "Slowly" },
      { nepali: "‡§ö‡§æ‡§Å‡§°‡•ã", roman: "Chaando", english: "Quickly" },
      { nepali: "‡§Æ‡§ø‡§†‡•ã", roman: "Mitho", english: "Sweet/Delicious" },
      { nepali: "‡§§‡§ø‡§§‡•ã", roman: "Tito", english: "Bitter" },
      { nepali: "‡§®‡•Å‡§®‡§ø‡§≤‡•ã", roman: "Nunilo", english: "Salty" },
      { nepali: "‡§ñ‡•Å‡§≤‡•ç‡§≤‡§æ", roman: "Khulla", english: "Open" },
      { nepali: "‡§¨‡§®‡•ç‡§¶", roman: "Banda", english: "Closed" },
      { nepali: "‡§∏‡§´‡§æ", roman: "Saphaa", english: "Clean" },
      { nepali: "‡§´‡•ã‡§π‡•ã‡§∞", roman: "Fohor", english: "Dirty" },
      { nepali: "‡§≠‡§æ‡§∞‡•Ä", roman: "Bhaari", english: "Heavy" },
      { nepali: "‡§π‡§≤‡•ç‡§ï‡§æ", roman: "Halka", english: "Light" },
      { nepali: "‡§ï‡§°‡§æ", roman: "Kada", english: "Hard" },
      { nepali: "‡§®‡§∞‡§Æ", roman: "Naram", english: "Soft" }
    ];

    // App state variables
    let shuffledWords = [...words].sort(() => Math.random() - 0.5);
    let currentIndex = 0;
    let currentModule = 'reading';
    let streak = 0;
    let totalCorrect = 0;
    let totalAttempts = 0;
    let learnedWords = new Set();
    let isRecording = false;
    let speechRecognition = null;
    let speechSupported = false;

    // Audio feedback system
    const audioContext = new (window.AudioContext || window.webkitAudioContext || null)();
    
    // Create audio feedback sounds
    function playSuccessSound() {
      if (!audioContext) return;
      
      // Correct answer sound - ascending chord progression
      const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
      notes.forEach((freq, i) => {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.1);
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0, audioContext.currentTime + i * 0.1);
        gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + i * 0.1 + 0.05);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.3);
        
        oscillator.start(audioContext.currentTime + i * 0.1);
        oscillator.stop(audioContext.currentTime + i * 0.1 + 0.3);
      });
    }

    function playErrorSound() {
      if (!audioContext) return;
      
      // Incorrect answer sound - descending tone
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
      oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.3);
      oscillator.type = 'sawtooth';
      
      gainNode.gain.setValueAtTime(0, audioContext.currentTime);
      gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.05);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.3);
    }

    function playClickSound() {
      if (!audioContext) return;
      
      // Soft click sound for button presses
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
      oscillator.type = 'sine';
      
      gainNode.gain.setValueAtTime(0, audioContext.currentTime);
      gainNode.gain.linearRampToValueAtTime(0.05, audioContext.currentTime + 0.01);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.1);
    }

    function playStreakSound() {
      if (!audioContext) return;
      
      // Special sound for maintaining streak
      const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
      notes.forEach((freq, i) => {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.08);
        oscillator.type = 'triangle';
        
        gainNode.gain.setValueAtTime(0, audioContext.currentTime + i * 0.08);
        gainNode.gain.linearRampToValueAtTime(0.08, audioContext.currentTime + i * 0.08 + 0.03);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.08 + 0.25);
        
        oscillator.start(audioContext.currentTime + i * 0.08);
        oscillator.stop(audioContext.currentTime + i * 0.08 + 0.25);
      });
    }

    // Initialize audio context on first user interaction
    function initAudioContext() {
      if (audioContext && audioContext.state === 'suspended') {
        audioContext.resume();
      }
    }

    // DOM elements
    const elements = {
      nepaliText: document.getElementById('nepaliText'),
      romanText: document.getElementById('romanText'),
      optionsGrid: document.getElementById('optionsGrid'),
      feedback: document.getElementById('feedback'),
      streak: document.getElementById('streak'),
      totalLearned: document.getElementById('totalLearned'),
      accuracy: document.getElementById('accuracy'),
      listenBtn: document.getElementById('listenBtn'),
      recordBtn: document.getElementById('recordBtn'),
      speakingControls: document.getElementById('speakingControls'),
      fallbackMessage: document.getElementById('fallbackMessage'),
      progressFill: document.getElementById('progressFill')
    };

    // Initialize app
    function init() {
      loadProgress();
      checkSpeechSupport();
      updateStats();
      setModule('reading');
      updateProgress();
    }

    // Check if speech recognition is supported
    function checkSpeechSupport() {
      // Check for different speech recognition APIs
      const hasWebkitSpeech = 'webkitSpeechRecognition' in window;
      const hasSpeech = 'SpeechRecognition' in window;
      const hasMediaDevices = navigator.mediaDevices && navigator.mediaDevices.getUserMedia;
      
      if (hasWebkitSpeech || hasSpeech) {
        speechSupported = true;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        speechRecognition = new SpeechRecognition();
        speechRecognition.continuous = false;
        speechRecognition.interimResults = false;
        speechRecognition.maxAlternatives = 3;
        
        // Try multiple language codes for better compatibility
        const languageCodes = ['ne-NP', 'ne', 'hi-IN', 'en-US'];
        speechRecognition.lang = languageCodes[0];
        
        speechRecognition.onresult = handleSpeechResult;
        speechRecognition.onerror = handleSpeechError;
        speechRecognition.onend = () => {
          isRecording = false;
          elements.recordBtn.classList.remove('recording');
          elements.recordBtn.innerHTML = 'üé§';
        };
      } else if (hasMediaDevices) {
        // Fallback: Basic audio recording for Firefox
        speechSupported = 'fallback';
      } else {
        speechSupported = false;
      }
    }

    // Load progress from localStorage
    function loadProgress() {
      try {
        const saved = JSON.parse(localStorage.getItem('nepalibuddy_progress') || '{}');
        streak = saved.streak || 0;
        totalCorrect = saved.totalCorrect || 0;
        totalAttempts = saved.totalAttempts || 0;
        learnedWords = new Set(saved.learnedWords || []);
        
        // Check if streak should reset (if last activity was not today)
        const lastActivity = saved.lastActivity;
        const today = new Date().toDateString();
        if (lastActivity !== today) {
          const yesterday = new Date();
          yesterday.setDate(yesterday.getDate() - 1);
          if (lastActivity !== yesterday.toDateString()) {
            streak = 0;
          }
        }
      } catch (e) {
        console.error('Error loading progress:', e);
      }
    }

    // Save progress to localStorage
    function saveProgress() {
      try {
        const progress = {
          streak,
          totalCorrect,
          totalAttempts,
          learnedWords: Array.from(learnedWords),
          lastActivity: new Date().toDateString()
        };
        localStorage.setItem('nepalibuddy_progress', JSON.stringify(progress));
      } catch (e) {
        console.error('Error saving progress:', e);
      }
    }

    // Update statistics display
    function updateStats() {
      elements.streak.textContent = streak;
      elements.totalLearned.textContent = learnedWords.size;
      const accuracy = totalAttempts > 0 ? Math.round((totalCorrect / totalAttempts) * 100) : 0;
      elements.accuracy.textContent = accuracy + '%';
    }

    // Update progress bar
    function updateProgress() {
      const progress = (learnedWords.size / words.length) * 100;
      elements.progressFill.style.width = progress + '%';
    }

    // Set learning module
    function setModule(module) {
      currentModule = module;
      
      // Update button states
      document.querySelectorAll('.module-btn').forEach(btn => btn.classList.remove('active'));
      event?.target?.classList.add('active') || document.querySelector(`[onclick="setModule('${module}')"]`)?.classList.add('active');
      
      // Show/hide appropriate controls
      if (module === 'reading') {
        elements.optionsGrid.style.display = 'grid';
        elements.speakingControls.classList.remove('active');
        elements.fallbackMessage.classList.add('hidden');
      } else {
        elements.optionsGrid.style.display = 'none';
        elements.speakingControls.classList.add('active');
        
        // Show appropriate message based on browser support
        if (speechSupported === false) {
          elements.fallbackMessage.innerHTML = `
            <strong>Speech recognition not available</strong><br>
            Try Chrome, Edge, or Safari for full speech features.<br>
            <em>You can still use the listening mode to practice pronunciation!</em>
          `;
          elements.fallbackMessage.classList.remove('hidden');
        } else if (speechSupported === 'fallback') {
          elements.fallbackMessage.innerHTML = `
            <strong>Limited speech support detected</strong><br>
            This browser has partial speech support. Try Chrome or Edge for the best experience.<br>
            <em>Listen and repeat mode available below!</em>
          `;
          elements.fallbackMessage.classList.remove('hidden');
        } else {
          elements.fallbackMessage.classList.add('hidden');
        }
      }
      
      elements.feedback.textContent = '';
      updateWord();
    }

    // Update current word display
    function updateWord() {
      if (shuffledWords.length === 0) return;
      
      const currentWord = shuffledWords[currentIndex];
      elements.nepaliText.textContent = currentWord.nepali;
      elements.romanText.textContent = currentWord.roman;

      if (currentModule === 'reading') {
        generateOptions(currentWord);
      }
    }

    // Generate multiple choice options
    function generateOptions(currentWord) {
      const options = [currentWord.english];
      
      // Add 3 random incorrect options
      while (options.length < 4) {
        const randomWord = words[Math.floor(Math.random() * words.length)];
        if (!options.includes(randomWord.english)) {
          options.push(randomWord.english);
        }
      }
      
      // Shuffle options
      options.sort(() => Math.random() - 0.5);
      
      // Create option cards
      elements.optionsGrid.innerHTML = '';
      options.forEach(option => {
        const card = document.createElement('div');
        card.className = 'option-card';
        card.textContent = option;
        card.onclick = () => handleAnswer(option, card);
        elements.optionsGrid.appendChild(card);
      });
    }

    // Handle answer selection
    function handleAnswer(choice, cardElement) {
      initAudioContext(); // Initialize audio on user interaction
      const currentWord = shuffledWords[currentIndex];
      const isCorrect = choice === currentWord.english;
      
      totalAttempts++;
      
      if (isCorrect) {
        totalCorrect++;
        learnedWords.add(currentWord.english);
        const previousStreak = streak;
        streak = Math.max(1, streak + 1);
        
        cardElement.classList.add('correct');
        elements.feedback.textContent = '‚úÖ Excellent!';
        elements.feedback.style.color = '#1dd1a1';
        
        // Play appropriate success sound
        if (streak > previousStreak && streak % 5 === 0) {
          playStreakSound(); // Special sound for streak milestones
        } else {
          playSuccessSound(); // Regular success sound
        }
        
        // Show streak celebration for milestones
        if (streak > 0 && streak % 5 === 0) {
          elements.feedback.textContent = `üî• ${streak} streak! Amazing!`;
        }
        
        // Disable all options
        document.querySelectorAll('.option-card').forEach(card => {
          card.style.pointerEvents = 'none';
        });
        
        setTimeout(nextWord, 1500);
      } else {
        cardElement.classList.add('incorrect');
        elements.feedback.textContent = '‚ùå Try again!';
        elements.feedback.style.color = '#ff6b6b';
        
        // Play error sound
        playErrorSound();
        
        // Disable this option but allow others
        cardElement.style.pointerEvents = 'none';
        
        setTimeout(() => {
          elements.feedback.textContent = '';
        }, 1000);
      }
      
      updateStats();
      updateProgress();
      saveProgress();
    }

    // Text-to-speech function
    function speakWord() {
      initAudioContext(); // Initialize audio on user interaction
      
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel(); // Cancel any ongoing speech
        
        const currentWord = shuffledWords[currentIndex];
        const utterance = new SpeechSynthesisUtterance(currentWord.nepali);
        
        // Try to find Nepali voice, fallback to default
        const voices = speechSynthesis.getVoices();
        const nepaliVoice = voices.find(voice => 
          voice.lang.includes('ne') || voice.name.toLowerCase().includes('nepali')
        );
        
        if (nepaliVoice) {
          utterance.voice = nepaliVoice;
        }
        
        utterance.lang = 'ne-NP';
        utterance.rate = 0.8;
        utterance.pitch = 1;
        
        elements.listenBtn.disabled = true;
        utterance.onend = () => {
          elements.listenBtn.disabled = false;
        };
        
        utterance.onstart = () => {
          playClickSound(); // Soft click when audio starts
        };
        
        speechSynthesis.speak(utterance);
      } else {
        elements.feedback.textContent = 'üîä Audio not available in this browser';
        playErrorSound();
        setTimeout(() => elements.feedback.textContent = '', 2000);
      }
    }

    // Handle speech recognition result
    function handleSpeechResult(event) {
      const currentWord = shuffledWords[currentIndex];
      const spokenText = event.results[0][0].transcript.toLowerCase().trim();
      
      elements.feedback.textContent = `You said: "${spokenText}"`;
      
      // Simple phonetic matching - check if spoken text is similar to expected
      const expectedLower = currentWord.nepali.toLowerCase();
      const romanLower = currentWord.roman.toLowerCase();
      
      // Check various matching criteria
      const isMatch = 
        spokenText === expectedLower ||
        spokenText === romanLower ||
        spokenText.includes(expectedLower) ||
        spokenText.includes(romanLower) ||
        levenshteinDistance(spokenText, expectedLower) <= 2 ||
        levenshteinDistance(spokenText, romanLower) <= 2;
      
      if (isMatch) {
        totalCorrect++;
        learnedWords.add(currentWord.english);
        const previousStreak = streak;
        streak = Math.max(1, streak + 1);
        
        elements.feedback.textContent += ' ‚úÖ Great pronunciation!';
        elements.feedback.style.color = '#1dd1a1';
        
        // Play appropriate success sound
        if (streak > previousStreak && streak % 5 === 0) {
          playStreakSound(); // Special sound for streak milestones
          elements.feedback.textContent = `üî• ${streak} streak! Perfect pronunciation!`;
        } else {
          playSuccessSound(); // Regular success sound
        }
        
        setTimeout(nextWord, 2000);
      } else {
        elements.feedback.textContent += ' üîÑ Try again!';
        elements.feedback.style.color = '#feca57';
        
        // Play gentle error sound (softer for speech attempts)
        playErrorSound();
        
        setTimeout(() => {
          elements.feedback.textContent = '';
        }, 2000);
      }
      
      totalAttempts++;
      updateStats();
      updateProgress();
      saveProgress();
    }

    // Handle speech recognition error
    function handleSpeechError(event) {
      console.error('Speech recognition error:', event.error);
      elements.feedback.textContent = '‚ùå Could not recognize speech. Try again.';
      elements.feedback.style.color = '#ff6b6b';
      
      setTimeout(() => {
        elements.feedback.textContent = '';
      }, 2000);
    }

    // Start/stop recording
    function toggleRecording() {
      if (speechSupported === true && speechRecognition) {
        // Full speech recognition available
        if (!isRecording) {
          isRecording = true;
          elements.recordBtn.classList.add('recording');
          elements.recordBtn.innerHTML = 'üõë';
          elements.feedback.textContent = 'Listening... Speak now!';
          elements.feedback.style.color = '#54a0ff';
          
          try {
            speechRecognition.start();
          } catch (e) {
            console.error('Speech recognition start error:', e);
            isRecording = false;
            elements.recordBtn.classList.remove('recording');
            elements.recordBtn.innerHTML = 'üé§';
            elements.feedback.textContent = 'Error starting speech recognition';
          }
        } else {
          speechRecognition.stop();
        }
      } else if (speechSupported === 'fallback') {
        // Fallback mode for Firefox - provide visual feedback and encouragement
        handleFallbackRecording();
      } else {
        // No speech support
        elements.feedback.textContent = 'Speech recognition not supported in this browser. Try Chrome, Edge, or Safari.';
        elements.feedback.style.color = '#ff6b6b';
        setTimeout(() => elements.feedback.textContent = '', 3000);
      }
    }

    // Fallback recording for browsers with limited speech support
    function handleFallbackRecording() {
      if (!isRecording) {
        isRecording = true;
        elements.recordBtn.classList.add('recording');
        elements.recordBtn.innerHTML = 'üõë';
        elements.feedback.textContent = 'üé§ Recording... Say the word aloud!';
        elements.feedback.style.color = '#54a0ff';
        
        playClickSound(); // Audio feedback for starting recording
        
        // Simulate recording for 3 seconds, then provide encouragement
        setTimeout(() => {
          isRecording = false;
          elements.recordBtn.classList.remove('recording');
          elements.recordBtn.innerHTML = 'üé§';
          
          const currentWord = shuffledWords[currentIndex];
          elements.feedback.innerHTML = `
            Great practice! üëè<br>
            You practiced: <strong>${currentWord.nepali}</strong> (${currentWord.roman})<br>
            <em>Keep practicing your pronunciation!</em>
          `;
          elements.feedback.style.color = '#1dd1a1';
          
          // Play success sound for practice
          playSuccessSound();
          
          // Count as practice (not fully correct, but engagement)
          totalAttempts++;
          learnedWords.add(currentWord.english);
          updateStats();
          updateProgress();
          saveProgress();
          
          setTimeout(() => {
            nextWord();
          }, 3000);
        }, 3000);
      } else {
        // Stop recording early
        isRecording = false;
        elements.recordBtn.classList.remove('recording');
        elements.recordBtn.innerHTML = 'üé§';
        elements.feedback.textContent = 'Recording stopped. Try again!';
        elements.feedback.style.color = '#feca57';
        
        playClickSound(); // Soft click for stopping
        
        setTimeout(() => elements.feedback.textContent = '', 2000);
      }
    }

    // Calculate Levenshtein distance for fuzzy string matching
    function levenshteinDistance(str1, str2) {
      const matrix = [];
      for (let i = 0; i <= str2.length; i++) {
        matrix[i] = [i];
      }
      for (let j = 0; j <= str1.length; j++) {
        matrix[0][j] = j;
      }
      for (let i = 1; i <= str2.length; i++) {
        for (let j = 1; j <= str1.length; j++) {
          if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
            matrix[i][j] = matrix[i - 1][j - 1];
          } else {
            matrix[i][j] = Math.min(
              matrix[i - 1][j - 1] + 1,
              matrix[i][j - 1] + 1,
              matrix[i - 1][j] + 1
            );
          }
        }
      }
      return matrix[str2.length][str1.length];
    }

    // Move to next word
    function nextWord() {
      currentIndex = (currentIndex + 1) % shuffledWords.length;
      
      // Reshuffle when we've gone through all words
      if (currentIndex === 0) {
        shuffledWords = [...words].sort(() => Math.random() - 0.5);
      }
      
      elements.feedback.textContent = '';
      updateWord();
    }

    // Skip current word
    function skipWord() {
      elements.feedback.textContent = 'Skipped! üîÑ';
      elements.feedback.style.color = '#feca57';
      setTimeout(() => {
        elements.feedback.textContent = '';
        nextWord();
      }, 800);
    }

    // Event listeners
    elements.listenBtn.onclick = speakWord;
    elements.recordBtn.onclick = toggleRecording;

    // Load voices when available
    if ('speechSynthesis' in window) {
      speechSynthesis.onvoiceschanged = () => {
        // Voices are now loaded
      };
    }

    // Initialize app when page loads
    init();

    // Make functions globally available
    window.setModule = setModule;
    window.skipWord = skipWord;
  </script>
</body>
</html>