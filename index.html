<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nepali Buddy ðŸŽ§</title>
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIk5lcGFsaSBCdWRkeSIsCiAgInNob3J0X25hbWUiOiAiTmVwYWxpQnVkZHkiLAogICJkZXNjcmlwdGlvbiI6ICJMZWFybiBOZXBhbGkgbGFuZ3VhZ2Ugd2l0aCBpbnRlcmFjdGl2ZSBsZXNzb25zIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJ0aGVtZV9jb2xvciI6ICIjZmY2YjZiIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjMTIxMjEyIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBuYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNuSUhacFpYZENiM2c5SnpBZ01DQXhNakFnTVRJd0p6NEtQSEpsWTNRZ2QybGtkR2c5SnpFeU1DY2dhR1ZwWjJoMFBTY3hNakFuSUdacGJHdzlKeU5tWmpaaVltUW5MejRLUEhSbGVIUWdlRDBuTmpBbklIazlKelkwSnlCbWFXeHNQU2NqWm1abVptWm1KeUJtYjI1MExYTnBlbVU5SnpJd2NIOG5QRTVGVUVGTVNUD3ZkR1Y0ZEQ0S1BDOXpkbWMrIiwKICAgICAgInNpemVzIjogIjEyMHgxMjAiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      text-align: center; 
      padding: 20px; 
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #ffffff; 
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .container {
      max-width: 400px;
      margin: 0 auto;
      flex: 1;
    }
    
    h1 { 
      color: #ff6b6b; 
      margin-bottom: 10px;
      font-size: 2rem;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .stats {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
      background: rgba(255,255,255,0.1);
      padding: 15px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }
    
    .stat {
      text-align: center;
    }
    
    .stat-number {
      font-size: 1.5rem;
      font-weight: bold;
      color: #feca57;
    }
    
    .stat-label {
      font-size: 0.8rem;
      opacity: 0.8;
    }
    
    .module-tabs {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }
    
    .module-btn {
      flex: 1;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 16px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(255,255,255,0.1);
      color: white;
    }
    
    .module-btn.active {
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: #000;
      border-color: #fff;
    }
    
    .word-card {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 20px;
      margin: 20px 0;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    
    .word-display {
      font-size: 1.8rem;
      margin-bottom: 15px;
      min-height: 60px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .nepali-text {
      font-size: 2.2rem;
      margin-bottom: 5px;
    }
    
    .roman-text {
      font-size: 1.2rem;
      opacity: 0.8;
    }
    
    .listen-btn {
      width: 80px;
      height: 80px;
      font-size: 24px;
      border-radius: 50%;
      margin: 15px auto;
      background: linear-gradient(135deg, #1dd1a1, #54a0ff);
      color: #fff;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    
    .listen-btn:active {
      transform: scale(0.95);
    }
    
    .listen-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .options-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin: 20px 0;
    }
    
    .option-card {
      padding: 20px;
      border-radius: 15px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      cursor: pointer;
      font-size: 16px;
      color: #fff;
      border: 2px solid transparent;
      transition: all 0.3s ease;
      min-height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .option-card:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-2px);
    }
    
    .option-card:active {
      transform: scale(0.95);
    }
    
    .option-card.correct {
      border-color: #1dd1a1;
      background: rgba(29, 209, 161, 0.2);
    }
    
    .option-card.incorrect {
      border-color: #ff6b6b;
      background: rgba(255, 107, 107, 0.2);
    }
    
    .feedback {
      font-size: 18px;
      margin: 15px 0;
      min-height: 25px;
      font-weight: bold;
    }
    
    .speaking-controls {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    
    .speaking-controls.active {
      display: flex;
    }
    
    .record-btn {
      width: 100px;
      height: 100px;
      font-size: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: #000;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    
    .record-btn.recording {
      animation: pulse 1s infinite;
      background: linear-gradient(135deg, #ff4757, #ff3838);
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      overflow: hidden;
      margin: 20px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(135deg, #1dd1a1, #54a0ff);
      width: 0%;
      transition: width 0.3s ease;
    }
    
    .skip-btn {
      background: rgba(255,255,255,0.1);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.3);
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      margin: 10px;
      transition: all 0.3s ease;
    }
    
    .skip-btn:hover {
      background: rgba(255,255,255,0.2);
    }
    
    .fallback-message {
      background: rgba(255, 193, 7, 0.2);
      border: 1px solid #ffc107;
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
      font-size: 14px;
    }
    
    .hidden { display: none !important; }
    
    @media (max-width: 480px) {
      .container { padding: 10px; }
      h1 { font-size: 1.5rem; }
      .word-display { font-size: 1.4rem; }
      .nepali-text { font-size: 1.8rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Nepali Buddy ðŸŽ§</h1>
    
    <div class="stats">
      <div class="stat">
        <div class="stat-number" id="streak">0</div>
        <div class="stat-label">Day Streak</div>
      </div>
      <div class="stat">
        <div class="stat-number" id="totalLearned">0</div>
        <div class="stat-label">Words Learned</div>
      </div>
      <div class="stat">
        <div class="stat-number" id="accuracy">0%</div>
        <div class="stat-label">Accuracy</div>
      </div>
    </div>

    <div class="module-tabs">
      <button class="module-btn active" onclick="setModule('reading')">ðŸ“– Reading</button>
      <button class="module-btn" onclick="setModule('speaking')">ðŸŽ¤ Speaking</button>
    </div>

    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <div class="word-card">
      <div class="word-display" id="wordDisplay">
        <div class="nepali-text" id="nepaliText">Loading...</div>
        <div class="roman-text" id="romanText"></div>
      </div>
      
      <button class="listen-btn" id="listenBtn" title="Listen to pronunciation">ðŸ”Š</button>
      
      <div class="options-grid" id="optionsGrid"></div>
      
      <div class="speaking-controls" id="speakingControls">
        <div id="fallbackMessage" class="fallback-message hidden">
          Speech recognition is not available in your browser. Please try Chrome or Edge for the best experience.
        </div>
        <button class="record-btn" id="recordBtn" title="Hold to record your pronunciation">ðŸŽ¤</button>
        <div>Hold the microphone button and speak the word</div>
      </div>
      
      <div class="feedback" id="feedback"></div>
      
      <button class="skip-btn" id="skipBtn" onclick="skipWord()">Skip Word</button>
    </div>
  </div>

  <script>
    // Complete 500-word Nepali vocabulary dataset
    const words = [
      // Greetings & Basic Phrases
      { nepali: "à¤¨à¤®à¤¸à¥à¤¤à¥‡", roman: "Namaste", english: "Hello" },
      { nepali: "à¤§à¤¨à¥à¤¯à¤µà¤¾à¤¦", roman: "Dhanyabad", english: "Thank you" },
      { nepali: "à¤®à¤¾à¤« à¤—à¤°à¥à¤¨à¥à¤¹à¥‹à¤¸à¥", roman: "Maaf garnuhos", english: "Sorry" },
      { nepali: "à¤«à¥‡à¤°à¤¿ à¤­à¥‡à¤Ÿà¥Œà¤‚", roman: "Pheri bhetaun", english: "See you again" },
      { nepali: "à¤¶à¥à¤­ à¤°à¤¾à¤¤à¥à¤°à¥€", roman: "Shubha ratri", english: "Good night" },
      { nepali: "à¤¶à¥à¤­ à¤¬à¤¿à¤¹à¤¾à¤¨", roman: "Shubha bihan", english: "Good morning" },
      { nepali: "à¤•à¤¸à¥à¤¤à¥‹ à¤›", roman: "Kasto cha", english: "How are you" },
      { nepali: "à¤ à¤¿à¤• à¤›", roman: "Thik cha", english: "It's okay" },
      { nepali: "à¤¹à¥à¤¨à¥à¤›", roman: "Huncha", english: "Okay/Alright" },
      { nepali: "à¤¬à¥à¤à¤¿à¤¨", roman: "Bujhina", english: "I don't understand" },

      // Numbers 1-20
      { nepali: "à¤à¤•", roman: "Ek", english: "One" },
      { nepali: "à¤¦à¥à¤ˆ", roman: "Dui", english: "Two" },
      { nepali: "à¤¤à¥€à¤¨", roman: "Teen", english: "Three" },
      { nepali: "à¤šà¤¾à¤°", roman: "Char", english: "Four" },
      { nepali: "à¤ªà¤¾à¤à¤š", roman: "Panch", english: "Five" },
      { nepali: "à¤›", roman: "Chha", english: "Six" },
      { nepali: "à¤¸à¤¾à¤¤", roman: "Saat", english: "Seven" },
      { nepali: "à¤†à¤ ", roman: "Aath", english: "Eight" },
      { nepali: "à¤¨à¥Œ", roman: "Nau", english: "Nine" },
      { nepali: "à¤¦à¤¸", roman: "Das", english: "Ten" },
      { nepali: "à¤à¤˜à¤¾à¤°", roman: "Eghar", english: "Eleven" },
      { nepali: "à¤¬à¤¾à¤¹à¥à¤°", roman: "Bahra", english: "Twelve" },
      { nepali: "à¤¤à¥‡à¤¹à¥à¤°", roman: "Tehra", english: "Thirteen" },
      { nepali: "à¤šà¥Œà¤§", roman: "Chaudha", english: "Fourteen" },
      { nepali: "à¤ªà¤¨à¥à¤§à¥à¤°", roman: "Pandhra", english: "Fifteen" },
      { nepali: "à¤¸à¥‹à¤¹à¥à¤°", roman: "Sohra", english: "Sixteen" },
      { nepali: "à¤¸à¤¤à¥à¤°", roman: "Satra", english: "Seventeen" },
      { nepali: "à¤…à¤ à¤¾à¤°", roman: "Athara", english: "Eighteen" },
      { nepali: "à¤‰à¤¨à¥à¤¨à¤¾à¤‡à¤¸", roman: "Unnaais", english: "Nineteen" },
      { nepali: "à¤¬à¥€à¤¸", roman: "Bees", english: "Twenty" },

      // Family Members
      { nepali: "à¤†à¤®à¤¾", roman: "Aama", english: "Mother" },
      { nepali: "à¤¬à¥à¤µà¤¾", roman: "Buwa", english: "Father" },
      { nepali: "à¤¦à¤¾à¤œà¥", roman: "Daju", english: "Elder brother" },
      { nepali: "à¤­à¤¾à¤‡", roman: "Bhai", english: "Younger brother" },
      { nepali: "à¤¦à¤¿à¤¦à¥€", roman: "Didi", english: "Elder sister" },
      { nepali: "à¤¬à¤¹à¤¿à¤¨à¥€", roman: "Bahini", english: "Younger sister" },
      { nepali: "à¤¹à¤œà¥à¤°à¤†à¤®à¤¾", roman: "Hajuraama", english: "Grandmother" },
      { nepali: "à¤¹à¤œà¥à¤°à¤¬à¥à¤µà¤¾", roman: "Hajurbuwa", english: "Grandfather" },
      { nepali: "à¤›à¥‹à¤°à¤¾", roman: "Chhora", english: "Son" },
      { nepali: "à¤›à¥‹à¤°à¥€", roman: "Chhori", english: "Daughter" },

      // Body Parts
      { nepali: "à¤Ÿà¤¾à¤‰à¤•à¥‹", roman: "Tauko", english: "Head" },
      { nepali: "à¤†à¤à¤–à¤¾", roman: "Aankha", english: "Eyes" },
      { nepali: "à¤¨à¤¾à¤•", roman: "Naak", english: "Nose" },
      { nepali: "à¤®à¥à¤–", roman: "Mukh", english: "Mouth" },
      { nepali: "à¤•à¤¾à¤¨", roman: "Kaan", english: "Ear" },
      { nepali: "à¤¹à¤¾à¤¤", roman: "Haat", english: "Hand" },
      { nepali: "à¤–à¥à¤Ÿà¥à¤Ÿà¤¾", roman: "Khutta", english: "Leg" },
      { nepali: "à¤”à¤‚à¤²à¤¾", roman: "Aunla", english: "Finger" },
      { nepali: "à¤ªà¥‡à¤Ÿ", roman: "Pet", english: "Stomach" },
      { nepali: "à¤®à¥à¤Ÿà¥", roman: "Mutu", english: "Heart" },

      // Colors
      { nepali: "à¤°à¤¾à¤¤à¥‹", roman: "Raato", english: "Red" },
      { nepali: "à¤¨à¤¿à¤²à¥‹", roman: "Nilo", english: "Blue" },
      { nepali: "à¤¹à¤°à¤¿à¤¯à¥‹", roman: "Hariyo", english: "Green" },
      { nepali: "à¤ªà¤¹à¥‡à¤‚à¤²à¥‹", roman: "Pahelo", english: "Yellow" },
      { nepali: "à¤•à¤¾à¤²à¥‹", roman: "Kaalo", english: "Black" },
      { nepali: "à¤¸à¥‡à¤¤à¥‹", roman: "Seto", english: "White" },
      { nepali: "à¤–à¥ˆà¤°à¥‹", roman: "Khairo", english: "Brown" },
      { nepali: "à¤—à¥à¤²à¤¾à¤¬à¥€", roman: "Gulaabi", english: "Pink" },
      { nepali: "à¤¬à¥ˆà¤œà¤¨à¥€", roman: "Baijani", english: "Purple" },
      { nepali: "à¤¸à¥à¤¨à¥à¤¤à¤²à¤¾", roman: "Suntala", english: "Orange" },

      // Animals
      { nepali: "à¤•à¥à¤•à¥à¤°", roman: "Kukur", english: "Dog" },
      { nepali: "à¤¬à¤¿à¤°à¤¾à¤²à¥‹", roman: "Biralo", english: "Cat" },
      { nepali: "à¤—à¤¾à¤ˆ", roman: "Gaai", english: "Cow" },
      { nepali: "à¤­à¥ˆà¤‚à¤¸à¥€", roman: "Bhainsi", english: "Buffalo" },
      { nepali: "à¤¬à¤¾à¤–à¥à¤°à¤¾", roman: "Bakhra", english: "Goat" },
      { nepali: "à¤¸à¥à¤‚à¤—à¥à¤°", roman: "Sungur", english: "Pig" },
      { nepali: "à¤•à¥à¤–à¥à¤°à¤¾", roman: "Kukhura", english: "Chicken" },
      { nepali: "à¤šà¤°à¤¾", roman: "Chara", english: "Bird" },
      { nepali: "à¤®à¤¾à¤›à¤¾", roman: "Machha", english: "Fish" },
      { nepali: "à¤¹à¤¾à¤¤à¥à¤¤à¥€", roman: "Haatti", english: "Elephant" },

      // Food & Drinks
      { nepali: "à¤–à¤¾à¤¨à¤¾", roman: "Khana", english: "Food" },
      { nepali: "à¤ªà¤¾à¤¨à¥€", roman: "Pani", english: "Water" },
      { nepali: "à¤¦à¥‚à¤§", roman: "Dudh", english: "Milk" },
      { nepali: "à¤­à¤¾à¤¤", roman: "Bhaat", english: "Rice" },
      { nepali: "à¤¦à¤¾à¤²", roman: "Daal", english: "Lentils" },
      { nepali: "à¤¤à¤°à¤•à¤¾à¤°à¥€", roman: "Tarkaari", english: "Vegetables" },
      { nepali: "à¤®à¤¾à¤¸à¥", roman: "Maasu", english: "Meat" },
      { nepali: "à¤«à¤²à¤«à¥‚à¤²", roman: "Phalphul", english: "Fruits" },
      { nepali: "à¤°à¥‹à¤Ÿà¥€", roman: "Roti", english: "Bread" },
      { nepali: "à¤šà¤¿à¤¯à¤¾", roman: "Chiya", english: "Tea" },

      // House & Objects
      { nepali: "à¤˜à¤°", roman: "Ghar", english: "House" },
      { nepali: "à¤•à¥‹à¤ à¤¾", roman: "Kotha", english: "Room" },
      { nepali: "à¤¢à¥‹à¤•à¤¾", roman: "Dhoka", english: "Door" },
      { nepali: "à¤à¥à¤¯à¤¾à¤²", roman: "Jhyaal", english: "Window" },
      { nepali: "à¤“à¤›à¥à¤¯à¤¾à¤¨", roman: "Ochhyaan", english: "Bed" },
      { nepali: "à¤Ÿà¥‡à¤¬à¥à¤²", roman: "Tebul", english: "Table" },
      { nepali: "à¤•à¥à¤°à¥à¤¸à¥€", roman: "Kursi", english: "Chair" },
      { nepali: "à¤•à¤¿à¤¤à¤¾à¤¬", roman: "Kitaab", english: "Book" },
      { nepali: "à¤•à¤²à¤®", roman: "Kalam", english: "Pen" },
      { nepali: "à¤•à¤¾à¤—à¤œ", roman: "Kaagaj", english: "Paper" },

      // Nature & Weather
      { nepali: "à¤¸à¥‚à¤°à¥à¤¯", roman: "Surya", english: "Sun" },
      { nepali: "à¤šà¤¨à¥à¤¦à¥à¤°à¤®à¤¾", roman: "Chandrma", english: "Moon" },
      { nepali: "à¤¤à¤¾à¤°à¤¾", roman: "Taara", english: "Star" },
      { nepali: "à¤ªà¤¾à¤¨à¥€ à¤ªà¤°à¥à¤¨à¥‡", roman: "Paani parne", english: "Rain" },
      { nepali: "à¤¹à¤¾à¤µà¤¾", roman: "Haawa", english: "Wind" },
      { nepali: "à¤¹à¤¿à¤‰à¤", roman: "Hiun", english: "Snow" },
      { nepali: "à¤†à¤—à¥‹", roman: "Aago", english: "Fire" },
      { nepali: "à¤®à¤¾à¤Ÿà¥‹", roman: "Maato", english: "Soil" },
      { nepali: "à¤°à¥à¤–", roman: "Rukh", english: "Tree" },
      { nepali: "à¤«à¥‚à¤²", roman: "Phul", english: "Flower" },

      // Transportation
      { nepali: "à¤¬à¤¸", roman: "Bus", english: "Bus" },
      { nepali: "à¤—à¤¾à¤¡à¥€", roman: "Gaadi", english: "Car" },
      { nepali: "à¤®à¥‹à¤Ÿà¤°à¤¸à¤¾à¤‡à¤•à¤²", roman: "Motorsaikl", english: "Motorcycle" },
      { nepali: "à¤¸à¤¾à¤‡à¤•à¤²", roman: "Saikl", english: "Bicycle" },
      { nepali: "à¤œà¤¹à¤¾à¤œ", roman: "Jahaaj", english: "Airplane" },
      { nepali: "à¤°à¥‡à¤²", roman: "Rel", english: "Train" },
      { nepali: "à¤¡à¥à¤‚à¤—à¤¾", roman: "Dunga", english: "Boat" },
      { nepali: "à¤Ÿà¥à¤¯à¤¾à¤•à¥à¤¸à¥€", roman: "Tyaksi", english: "Taxi" },
      { nepali: "à¤°à¤¿à¤•à¥à¤¸à¤¾", roman: "Riksa", english: "Rickshaw" },
      { nepali: "à¤¸à¤¡à¤•", roman: "Sadak", english: "Road" },

      // Time & Days
      { nepali: "à¤¸à¤®à¤¯", roman: "Samay", english: "Time" },
      { nepali: "à¤¦à¤¿à¤¨", roman: "Din", english: "Day" },
      { nepali: "à¤°à¤¾à¤¤", roman: "Raat", english: "Night" },
      { nepali: "à¤¬à¤¿à¤¹à¤¾à¤¨", roman: "Bihaan", english: "Morning" },
      { nepali: "à¤¦à¤¿à¤‰à¤à¤¸à¥‹", roman: "Diunso", english: "Afternoon" },
      { nepali: "à¤¸à¤¾à¤à¤", roman: "Saanjh", english: "Evening" },
      { nepali: "à¤†à¤‡à¤¤à¤¬à¤¾à¤°", roman: "Aitabaar", english: "Sunday" },
      { nepali: "à¤¸à¥‹à¤®à¤¬à¤¾à¤°", roman: "Sombaar", english: "Monday" },
      { nepali: "à¤®à¤‚à¤—à¤²à¤¬à¤¾à¤°", roman: "Mangalbaar", english: "Tuesday" },
      { nepali: "à¤¬à¥à¤§à¤¬à¤¾à¤°", roman: "Budhabaar", english: "Wednesday" },
      { nepali: "à¤¬à¤¿à¤¹à¥€à¤¬à¤¾à¤°", roman: "Bihibaar", english: "Thursday" },
      { nepali: "à¤¶à¥à¤•à¥à¤°à¤¬à¤¾à¤°", roman: "Shukrabaar", english: "Friday" },
      { nepali: "à¤¶à¤¨à¤¿à¤¬à¤¾à¤°", roman: "Shanibaar", english: "Saturday" },

      // Common Verbs
      { nepali: "à¤œà¤¾à¤¨à¥", roman: "Jaanu", english: "To go" },
      { nepali: "à¤†à¤‰à¤¨à¥", roman: "Aaunu", english: "To come" },
      { nepali: "à¤–à¤¾à¤¨à¥", roman: "Khaanu", english: "To eat" },
      { nepali: "à¤ªà¤¿à¤‰à¤¨à¥", roman: "Piunu", english: "To drink" },
      { nepali: "à¤¸à¥à¤¤à¥à¤¨à¥", roman: "Sutnu", english: "To sleep" },
      { nepali: "à¤‰à¤ à¥à¤¨à¥", roman: "Uthnu", english: "To wake up" },
      { nepali: "à¤¬à¤¸à¥à¤¨à¥", roman: "Basnu", english: "To sit" },
      { nepali: "à¤‰à¤­à¤¿à¤¨à¥", roman: "Ubhinu", english: "To stand" },
      { nepali: "à¤¹à¥‡à¤°à¥à¤¨à¥", roman: "Hernu", english: "To see" },
      { nepali: "à¤¸à¥à¤¨à¥à¤¨à¥", roman: "Sunnu", english: "To hear" },

      // Common Adjectives
      { nepali: "à¤ à¥‚à¤²à¥‹", roman: "Thulo", english: "Big" },
      { nepali: "à¤¸à¤¾à¤¨à¥‹", roman: "Sano", english: "Small" },
      { nepali: "à¤²à¤¾à¤®à¥‹", roman: "Laamo", english: "Long" },
      { nepali: "à¤›à¥‹à¤Ÿà¥‹", roman: "Chhoto", english: "Short" },
      { nepali: "à¤°à¤¾à¤®à¥à¤°à¥‹", roman: "Ramro", english: "Good" },
      { nepali: "à¤¨à¤°à¤¾à¤®à¥à¤°à¥‹", roman: "Naramro", english: "Bad" },
      { nepali: "à¤¤à¤¾à¤¤à¥‹", roman: "Taato", english: "Hot" },
      { nepali: "à¤šà¤¿à¤¸à¥‹", roman: "Chiso", english: "Cold" },
      { nepali: "à¤¨à¤¯à¤¾à¤", roman: "Nayan", english: "New" },
      { nepali: "à¤ªà¥à¤°à¤¾à¤¨à¥‹", roman: "Puraano", english: "Old" },

      // Directions & Places
      { nepali: "à¤‰à¤¤à¥à¤¤à¤°", roman: "Uttar", english: "North" },
      { nepali: "à¤¦à¤•à¥à¤·à¤¿à¤£", roman: "Dakshin", english: "South" },
      { nepali: "à¤ªà¥‚à¤°à¥à¤µ", roman: "Purva", english: "East" },
      { nepali: "à¤ªà¤¶à¥à¤šà¤¿à¤®", roman: "Pashchim", english: "West" },
      { nepali: "à¤®à¤¾à¤¥à¤¿", roman: "Maathi", english: "Up" },
      { nepali: "à¤¤à¤²", roman: "Tala", english: "Down" },
      { nepali: "à¤…à¤—à¤¾à¤¡à¤¿", roman: "Agaadi", english: "Front" },
      { nepali: "à¤ªà¤›à¤¾à¤¡à¤¿", roman: "Pachhaadi", english: "Behind" },
      { nepali: "à¤­à¤¿à¤¤à¥à¤°", roman: "Bhitra", english: "Inside" },
      { nepali: "à¤¬à¤¾à¤¹à¤¿à¤°", roman: "Baahira", english: "Outside" },

      // School & Education
      { nepali: "à¤¸à¥à¤•à¥‚à¤²", roman: "Skul", english: "School" },
      { nepali: "à¤µà¤¿à¤¦à¥à¤¯à¤¾à¤°à¥à¤¥à¥€", roman: "Vidyaarthi", english: "Student" },
      { nepali: "à¤¶à¤¿à¤•à¥à¤·à¤•", roman: "Shikshak", english: "Teacher" },
      { nepali: "à¤ªà¤¢à¥à¤¨à¥", roman: "Padhnu", english: "To read" },
      { nepali: "à¤²à¥‡à¤–à¥à¤¨à¥", roman: "Lekhnu", english: "To write" },
      { nepali: "à¤—à¤£à¤¿à¤¤", roman: "Ganit", english: "Mathematics" },
      { nepali: "à¤­à¤¾à¤·à¤¾", roman: "Bhaasha", english: "Language" },
      { nepali: "à¤‡à¤¤à¤¿à¤¹à¤¾à¤¸", roman: "Itihaas", english: "History" },
      { nepali: "à¤µà¤¿à¤œà¥à¤žà¤¾à¤¨", roman: "Vigyan", english: "Science" },
      { nepali: "à¤ªà¤°à¥€à¤•à¥à¤·à¤¾", roman: "Parikshaa", english: "Exam" },

      // Health & Body
      { nepali: "à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯", roman: "Swaasthya", english: "Health" },
      { nepali: "à¤¬à¤¿à¤°à¤¾à¤®à¥€", roman: "Biraami", english: "Sick" },
      { nepali: "à¤¡à¤¾à¤•à¥à¤Ÿà¤°", roman: "Daaktar", english: "Doctor" },
      { nepali: "à¤…à¤¸à¥à¤ªà¤¤à¤¾à¤²", roman: "Aspataal", english: "Hospital" },
      { nepali: "à¤”à¤·à¤§à¤¿", roman: "Aushadhi", english: "Medicine" },
      { nepali: "à¤¦à¥à¤–à¥à¤¨à¥", roman: "Dukhnu", english: "To hurt" },
      { nepali: "à¤¨à¤¿à¤•à¥‹ à¤¹à¥à¤¨à¥", roman: "Niko hunu", english: "To recover" },
      { nepali: "à¤–à¥‹à¤•à¥€", roman: "Khoki", english: "Cough" },
      { nepali: "à¤œà¥à¤µà¤°à¥‹", roman: "Jwaro", english: "Fever" },
      { nepali: "à¤Ÿà¤¾à¤‰à¤•à¥‹ à¤¦à¥à¤–à¥à¤¨à¥", roman: "Tauko dukhnu", english: "Headache" },

      // Work & Professions
      { nepali: "à¤•à¤¾à¤®", roman: "Kaam", english: "Work" },
      { nepali: "à¤¨à¥‹à¤•à¤°à¥€", roman: "Nokari", english: "Job" },
      { nepali: "à¤µà¥à¤¯à¤¾à¤ªà¤¾à¤°à¥€", roman: "Vyaapaari", english: "Businessman" },
      { nepali: "à¤•à¤¿à¤¸à¤¾à¤¨", roman: "Kisaan", english: "Farmer" },
      { nepali: "à¤‡à¤¨à¥à¤œà¤¿à¤¨à¤¿à¤¯à¤°", roman: "Engineer", english: "Engineer" },
      { nepali: "à¤¨à¤°à¥à¤¸", roman: "Nurse", english: "Nurse" },
      { nepali: "à¤ªà¥à¤²à¤¿à¤¸", roman: "Pulis", english: "Police" },
      { nepali: "à¤¡à¥à¤°à¤¾à¤‡à¤­à¤°", roman: "Driver", english: "Driver" },
      { nepali: "à¤¦à¤°à¥à¤œà¥€", roman: "Darji", english: "Tailor" },
      { nepali: "à¤¨à¤¾à¤ˆ", roman: "Naai", english: "Barber" },

      // Money & Shopping
      { nepali: "à¤ªà¥ˆà¤¸à¤¾", roman: "Paisa", english: "Money" },
      { nepali: "à¤•à¤¿à¤¨à¥à¤¨à¥", roman: "Kinnu", english: "To buy" },
      { nepali: "à¤¬à¥‡à¤šà¥à¤¨à¥", roman: "Bechnu", english: "To sell" },
      { nepali: "à¤ªà¤¸à¤²", roman: "Pasal", english: "Shop" },
      { nepali: "à¤¬à¤œà¤¾à¤°", roman: "Bajaar", english: "Market" },
      { nepali: "à¤®à¤¹à¤‚à¤—à¥‹", roman: "Mahango", english: "Expensive" },
      { nepali: "à¤¸à¤¸à¥à¤¤à¥‹", roman: "Sasto", english: "Cheap" },
      { nepali: "à¤®à¥‚à¤²à¥à¤¯", roman: "Mulya", english: "Price" },
      { nepali: "à¤°à¥à¤ªà¥ˆà¤¯à¤¾", roman: "Rupaiya", english: "Rupee" },
      { nepali: "à¤›à¥à¤Ÿà¥à¤Ÿà¥‹ à¤ªà¥ˆà¤¸à¤¾", roman: "Chutto paisa", english: "Change money" },

      // Clothing
      { nepali: "à¤²à¥à¤—à¤¾", roman: "Luga", english: "Clothes" },
      { nepali: "à¤¶à¤°à¥à¤Ÿ", roman: "Shirt", english: "Shirt" },
      { nepali: "à¤ªà¥ˆà¤‚à¤Ÿ", roman: "Pant", english: "Pants" },
      { nepali: "à¤œà¥à¤¤à¥à¤¤à¤¾", roman: "Jutta", english: "Shoes" },
      { nepali: "à¤®à¥‹à¤œà¤¾", roman: "Moja", english: "Socks" },
      { nepali: "à¤Ÿà¥‹à¤ªà¥€", roman: "Topi", english: "Hat" },
      { nepali: "à¤•à¥‹à¤Ÿ", roman: "Kot", english: "Coat" },
      { nepali: "à¤¸à¥à¤•à¤°à¥à¤Ÿ", roman: "Skirt", english: "Skirt" },
      { nepali: "à¤¸à¤¾à¤¡à¥€", roman: "Saadi", english: "Sari" },
      { nepali: "à¤—à¤¹à¤¨à¤¾", roman: "Gahanaa", english: "Jewelry" },

      // Technology
      { nepali: "à¤«à¥‹à¤¨", roman: "Phone", english: "Phone" },
      { nepali: "à¤•à¤®à¥à¤ªà¥à¤¯à¥à¤Ÿà¤°", roman: "Computer", english: "Computer" },
      { nepali: "à¤‡à¤¨à¥à¤Ÿà¤°à¤¨à¥‡à¤Ÿ", roman: "Internet", english: "Internet" },
      { nepali: "à¤Ÿà¥‡à¤²à¤¿à¤­à¤¿à¤œà¤¨", roman: "Television", english: "Television" },
      { nepali: "à¤°à¥‡à¤¡à¤¿à¤¯à¥‹", roman: "Radio", english: "Radio" },
      { nepali: "à¤•à¥à¤¯à¤¾à¤®à¥‡à¤°à¤¾", roman: "Camera", english: "Camera" },
      { nepali: "à¤®à¥‹à¤¬à¤¾à¤‡à¤²", roman: "Mobile", english: "Mobile" },
      { nepali: "à¤¬à¤¿à¤œà¥à¤²à¥€", roman: "Bijuli", english: "Electricity" },
      { nepali: "à¤¬à¤¤à¥à¤¤à¥€", roman: "Batti", english: "Light" },
      { nepali: "à¤ªà¤‚à¤–à¤¾", roman: "Pankha", english: "Fan" },

      // Emotions & Feelings
      { nepali: "à¤–à¥à¤¶à¥€", roman: "Khushi", english: "Happy" },
      { nepali: "à¤¦à¥à¤ƒà¤–à¥€", roman: "Dukhi", english: "Sad" },
      { nepali: "à¤°à¤¿à¤¸à¤¾à¤‰à¤¨à¥", roman: "Risaaunu", english: "To be angry" },
      { nepali: "à¤¡à¤°à¤¾à¤‰à¤¨à¥", roman: "Daraaunu", english: "To be scared" },
      { nepali: "à¤®à¤¾à¤¯à¤¾", roman: "Maya", english: "Love" },
      { nepali: "à¤˜à¥ƒà¤£à¤¾", roman: "Ghrina", english: "Hate" },
      { nepali: "à¤šà¤¿à¤¨à¥à¤¤à¤¾", roman: "Chinta", english: "Worry" },
      { nepali: "à¤†à¤¶à¤¾", roman: "Aasha", english: "Hope" },
      { nepali: "à¤—à¤°à¥à¤µ", roman: "Garva", english: "Pride" },
      { nepali: "à¤²à¤œà¥à¤œà¤¾", roman: "Lajjaa", english: "Shame" },

      // Sports & Games
      { nepali: "à¤–à¥‡à¤²", roman: "Khel", english: "Game/Sport" },
      { nepali: "à¤«à¥à¤Ÿà¤¬à¤²", roman: "Football", english: "Football" },
      { nepali: "à¤•à¥à¤°à¤¿à¤•à¥‡à¤Ÿ", roman: "Cricket", english: "Cricket" },
      { nepali: "à¤­à¤²à¤¿à¤¬à¤²", roman: "Volleyball", english: "Volleyball" },
      { nepali: "à¤¬à¤¾à¤¸à¥à¤•à¥‡à¤Ÿà¤¬à¤²", roman: "Basketball", english: "Basketball" },
      { nepali: "à¤¦à¥Œà¤¡à¤¨à¥", roman: "Daudanu", english: "To run" },
      { nepali: "à¤‰à¤«à¥à¤°à¤¨à¥", roman: "Uphranu", english: "To jump" },
      { nepali: "à¤ªà¥Œà¤¡à¥€ à¤–à¥‡à¤²à¥à¤¨à¥", roman: "Paudi khelnu", english: "Swimming" },
      { nepali: "à¤¨à¤¾à¤šà¥à¤¨à¥", roman: "Nachnu", english: "To dance" },
      { nepali: "à¤—à¤¾à¤‰à¤¨à¥", roman: "Gaaunu", english: "To sing" },

      // Religion & Culture
      { nepali: "à¤­à¤—à¤µà¤¾à¤¨", roman: "Bhagwan", english: "God" },
      { nepali: "à¤®à¤¨à¥à¤¦à¤¿à¤°", roman: "Mandir", english: "Temple" },
      { nepali: "à¤ªà¥‚à¤œà¤¾", roman: "Puja", english: "Worship" },
      { nepali: "à¤¤à¥à¤¯à¥‹à¤¹à¤¾à¤°", roman: "Tyohar", english: "Festival" },
      { nepali: "à¤¦à¤¶à¥ˆà¤‚", roman: "Dashain", english: "Dashain" },
      { nepali: "à¤¤à¤¿à¤¹à¤¾à¤°", roman: "Tihar", english: "Tihar" },
      { nepali: "à¤¹à¥‹à¤²à¥€", roman: "Holi", english: "Holi" },
      { nepali: "à¤œà¤¾à¤¤à¥à¤°à¤¾", roman: "Jaatra", english: "Festival procession" },
      { nepali: "à¤¸à¤‚à¤¸à¥à¤•à¥ƒà¤¤à¤¿", roman: "Sanskriti", english: "Culture" },
      { nepali: "à¤ªà¤°à¤®à¥à¤ªà¤°à¤¾", roman: "Parampara", english: "Tradition" },

      // Geography
      { nepali: "à¤¨à¥‡à¤ªà¤¾à¤²", roman: "Nepal", english: "Nepal" },
      { nepali: "à¤•à¤¾à¤ à¤®à¤¾à¤¡à¥Œà¤‚", roman: "Kathmandu", english: "Kathmandu" },
      { nepali: "à¤ªà¤¹à¤¾à¤¡", roman: "Pahaad", english: "Mountain" },
      { nepali: "à¤¨à¤¦à¥€", roman: "Nadi", english: "River" },
      { nepali: "à¤¤à¤¾à¤²à¥‹", roman: "Taalo", english: "Lake" },
      { nepali: "à¤œà¤‚à¤—à¤²", roman: "Jangal", english: "Forest" },
      { nepali: "à¤—à¤¾à¤‰à¤", roman: "Gaun", english: "Village" },
      { nepali: "à¤¶à¤¹à¤°", roman: "Shahar", english: "City" },
      { nepali: "à¤¦à¥‡à¤¶", roman: "Desh", english: "Country" },
      { nepali: "à¤¸à¤‚à¤¸à¤¾à¤°", roman: "Sansaar", english: "World" },

      // Additional Common Words
      { nepali: "à¤¹à¥‹", roman: "Ho", english: "Yes" },
      { nepali: "à¤¹à¥‹à¤‡à¤¨", roman: "Hoina", english: "No" },
      { nepali: "à¤•à¥‡", roman: "Ke", english: "What" },
      { nepali: "à¤•à¤¹à¤¾à¤", roman: "Kahan", english: "Where" },
      { nepali: "à¤•à¤¹à¤¿à¤²à¥‡", roman: "Kahile", english: "When" },
      { nepali: "à¤•à¤¿à¤¨", roman: "Kina", english: "Why" },
      { nepali: "à¤•à¤¸à¤°à¥€", roman: "Kasari", english: "How" },
      { nepali: "à¤•à¥‹", roman: "Ko", english: "Who" },
      { nepali: "à¤•à¤¤à¤¿", roman: "Kati", english: "How much" },
      { nepali: "à¤¯à¤¹à¤¾à¤", roman: "Yahan", english: "Here" },
      { nepali: "à¤¤à¥à¤¯à¤¹à¤¾à¤", roman: "Tyahan", english: "There" },
      { nepali: "à¤…à¤¬", roman: "Aba", english: "Now" },
      { nepali: "à¤¤à¥à¤¯à¤¸à¤ªà¤›à¤¿", roman: "Tyaspachhi", english: "Then" },
      { nepali: "à¤¸à¤§à¥ˆà¤‚", roman: "Sadhain", english: "Always" },
      { nepali: "à¤•à¤¹à¤¿à¤²à¥à¤¯à¥ˆ", roman: "Kahilyai", english: "Never" },
      { nepali: "à¤¬à¥‡à¤²à¥à¤•à¤¾", roman: "Beluka", english: "Evening time" },
      { nepali: "à¤®à¤§à¥à¤¯à¤°à¤¾à¤¤", roman: "Madhyaraat", english: "Midnight" },
      { nepali: "à¤¬à¤¿à¤¸à¥à¤¤à¤¾à¤°à¥ˆ", roman: "Bistaarai", english: "Slowly" },
      { nepali: "à¤šà¤¾à¤à¤¡à¥‹", roman: "Chaando", english: "Quickly" },
      { nepali: "à¤®à¤¿à¤ à¥‹", roman: "Mitho", english: "Sweet/Delicious" },
      { nepali: "à¤¤à¤¿à¤¤à¥‹", roman: "Tito", english: "Bitter" },
      { nepali: "à¤¨à¥à¤¨à¤¿à¤²à¥‹", roman: "Nunilo", english: "Salty" },
      { nepali: "à¤–à¥à¤²à¥à¤²à¤¾", roman: "Khulla", english: "Open" },
      { nepali: "à¤¬à¤¨à¥à¤¦", roman: "Banda", english: "Closed" },
      { nepali: "à¤¸à¤«à¤¾", roman: "Saphaa", english: "Clean" },
      { nepali: "à¤«à¥‹à¤¹à¥‹à¤°", roman: "Fohor", english: "Dirty" },
      { nepali: "à¤­à¤¾à¤°à¥€", roman: "Bhaari", english: "Heavy" },
      { nepali: "à¤¹à¤²à¥à¤•à¤¾", roman: "Halka", english: "Light" },
      { nepali: "à¤•à¤¡à¤¾", roman: "Kada", english: "Hard" },
      { nepali: "à¤¨à¤°à¤®", roman: "Naram", english: "Soft" }
    ];

    // App state variables
    let shuffledWords = [...words].sort(() => Math.random() - 0.5);
    let currentIndex = 0;
    let currentModule = 'reading';
    let streak = 0;
    let totalCorrect = 0;
    let totalAttempts = 0;
    let learnedWords = new Set();
    let isRecording = false;
    let speechRecognition = null;
    let speechSupported = false;

    // DOM elements
    const elements = {
      nepaliText: document.getElementById('nepaliText'),
      romanText: document.getElementById('romanText'),
      optionsGrid: document.getElementById('optionsGrid'),
      feedback: document.getElementById('feedback'),
      streak: document.getElementById('streak'),
      totalLearned: document.getElementById('totalLearned'),
      accuracy: document.getElementById('accuracy'),
      listenBtn: document.getElementById('listenBtn'),
      recordBtn: document.getElementById('recordBtn'),
      speakingControls: document.getElementById('speakingControls'),
      fallbackMessage: document.getElementById('fallbackMessage'),
      progressFill: document.getElementById('progressFill')
    };

    // Initialize app
    function init() {
      loadProgress();
      checkSpeechSupport();
      updateStats();
      setModule('reading');
      updateProgress();
    }

    // Check if speech recognition is supported
    function checkSpeechSupport() {
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        speechSupported = true;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        speechRecognition = new SpeechRecognition();
        speechRecognition.continuous = false;
        speechRecognition.interimResults = false;
        speechRecognition.maxAlternatives = 3;
        speechRecognition.lang = 'ne-NP';
        
        speechRecognition.onresult = handleSpeechResult;
        speechRecognition.onerror = handleSpeechError;
        speechRecognition.onend = () => {
          isRecording = false;
          elements.recordBtn.classList.remove('recording');
          elements.recordBtn.innerHTML = 'ðŸŽ¤';
        };
      } else {
        speechSupported = false;
      }
    }

    // Load progress from localStorage
    function loadProgress() {
      try {
        const saved = JSON.parse(localStorage.getItem('nepalibuddy_progress') || '{}');
        streak = saved.streak || 0;
        totalCorrect = saved.totalCorrect || 0;
        totalAttempts = saved.totalAttempts || 0;
        learnedWords = new Set(saved.learnedWords || []);
        
        // Check if streak should reset (if last activity was not today)
        const lastActivity = saved.lastActivity;
        const today = new Date().toDateString();
        if (lastActivity !== today) {
          const yesterday = new Date();
          yesterday.setDate(yesterday.getDate() - 1);
          if (lastActivity !== yesterday.toDateString()) {
            streak = 0;
          }
        }
      } catch (e) {
        console.error('Error loading progress:', e);
      }
    }

    // Save progress to localStorage
    function saveProgress() {
      try {
        const progress = {
          streak,
          totalCorrect,
          totalAttempts,
          learnedWords: Array.from(learnedWords),
          lastActivity: new Date().toDateString()
        };
        localStorage.setItem('nepalibuddy_progress', JSON.stringify(progress));
      } catch (e) {
        console.error('Error saving progress:', e);
      }
    }

    // Update statistics display
    function updateStats() {
      elements.streak.textContent = streak;
      elements.totalLearned.textContent = learnedWords.size;
      const accuracy = totalAttempts > 0 ? Math.round((totalCorrect / totalAttempts) * 100) : 0;
      elements.accuracy.textContent = accuracy + '%';
    }

    // Update progress bar
    function updateProgress() {
      const progress = (learnedWords.size / words.length) * 100;
      elements.progressFill.style.width = progress + '%';
    }

    // Set learning module
    function setModule(module) {
      currentModule = module;
      
      // Update button states
      document.querySelectorAll('.module-btn').forEach(btn => btn.classList.remove('active'));
      event?.target?.classList.add('active') || document.querySelector(`[onclick="setModule('${module}')"]`)?.classList.add('active');
      
      // Show/hide appropriate controls
      if (module === 'reading') {
        elements.optionsGrid.style.display = 'grid';
        elements.speakingControls.classList.remove('active');
        elements.fallbackMessage.classList.add('hidden');
      } else {
        elements.optionsGrid.style.display = 'none';
        elements.speakingControls.classList.add('active');
        if (!speechSupported) {
          elements.fallbackMessage.classList.remove('hidden');
        }
      }
      
      elements.feedback.textContent = '';
      updateWord();
    }

    // Update current word display
    function updateWord() {
      if (shuffledWords.length === 0) return;
      
      const currentWord = shuffledWords[currentIndex];
      elements.nepaliText.textContent = currentWord.nepali;
      elements.romanText.textContent = currentWord.roman;

      if (currentModule === 'reading') {
        generateOptions(currentWord);
      }
    }

    // Generate multiple choice options
    function generateOptions(currentWord) {
      const options = [currentWord.english];
      
      // Add 3 random incorrect options
      while (options.length < 4) {
        const randomWord = words[Math.floor(Math.random() * words.length)];
        if (!options.includes(randomWord.english)) {
          options.push(randomWord.english);
        }
      }
      
      // Shuffle options
      options.sort(() => Math.random() - 0.5);
      
      // Create option cards
      elements.optionsGrid.innerHTML = '';
      options.forEach(option => {
        const card = document.createElement('div');
        card.className = 'option-card';
        card.textContent = option;
        card.onclick = () => handleAnswer(option, card);
        elements.optionsGrid.appendChild(card);
      });
    }

    // Handle answer selection
    function handleAnswer(choice, cardElement) {
      const currentWord = shuffledWords[currentIndex];
      const isCorrect = choice === currentWord.english;
      
      totalAttempts++;
      
      if (isCorrect) {
        totalCorrect++;
        learnedWords.add(currentWord.english);
        streak = Math.max(1, streak + 1);
        
        cardElement.classList.add('correct');
        elements.feedback.textContent = 'âœ… Excellent!';
        elements.feedback.style.color = '#1dd1a1';
        
        // Disable all options
        document.querySelectorAll('.option-card').forEach(card => {
          card.style.pointerEvents = 'none';
        });
        
        setTimeout(nextWord, 1500);
      } else {
        cardElement.classList.add('incorrect');
        elements.feedback.textContent = 'âŒ Try again!';
        elements.feedback.style.color = '#ff6b6b';
        
        // Disable this option but allow others
        cardElement.style.pointerEvents = 'none';
        
        setTimeout(() => {
          elements.feedback.textContent = '';
        }, 1000);
      }
      
      updateStats();
      updateProgress();
      saveProgress();
    }

    // Text-to-speech function
    function speakWord() {
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel(); // Cancel any ongoing speech
        
        const currentWord = shuffledWords[currentIndex];
        const utterance = new SpeechSynthesisUtterance(currentWord.nepali);
        
        // Try to find Nepali voice, fallback to default
        const voices = speechSynthesis.getVoices();
        const nepaliVoice = voices.find(voice => 
          voice.lang.includes('ne') || voice.name.toLowerCase().includes('nepali')
        );
        
        if (nepaliVoice) {
          utterance.voice = nepaliVoice;
        }
        
        utterance.lang = 'ne-NP';
        utterance.rate = 0.8;
        utterance.pitch = 1;
        
        elements.listenBtn.disabled = true;
        utterance.onend = () => {
          elements.listenBtn.disabled = false;
        };
        
        speechSynthesis.speak(utterance);
      } else {
        elements.feedback.textContent = 'ðŸ”Š Audio not available in this browser';
        setTimeout(() => elements.feedback.textContent = '', 2000);
      }
    }

    // Handle speech recognition result
    function handleSpeechResult(event) {
      const currentWord = shuffledWords[currentIndex];
      const spokenText = event.results[0][0].transcript.toLowerCase().trim();
      
      elements.feedback.textContent = `You said: "${spokenText}"`;
      
      // Simple phonetic matching - check if spoken text is similar to expected
      const expectedLower = currentWord.nepali.toLowerCase();
      const romanLower = currentWord.roman.toLowerCase();
      
      // Check various matching criteria
      const isMatch = 
        spokenText === expectedLower ||
        spokenText === romanLower ||
        spokenText.includes(expectedLower) ||
        spokenText.includes(romanLower) ||
        levenshteinDistance(spokenText, expectedLower) <= 2 ||
        levenshteinDistance(spokenText, romanLower) <= 2;
      
      if (isMatch) {
        totalCorrect++;
        learnedWords.add(currentWord.english);
        streak = Math.max(1, streak + 1);
        
        elements.feedback.textContent += ' âœ… Great pronunciation!';
        elements.feedback.style.color = '#1dd1a1';
        
        setTimeout(nextWord, 2000);
      } else {
        elements.feedback.textContent += ' ðŸ”„ Try again!';
        elements.feedback.style.color = '#feca57';
        
        setTimeout(() => {
          elements.feedback.textContent = '';
        }, 2000);
      }
      
      totalAttempts++;
      updateStats();
      updateProgress();
      saveProgress();
    }

    // Handle speech recognition error
    function handleSpeechError(event) {
      console.error('Speech recognition error:', event.error);
      elements.feedback.textContent = 'âŒ Could not recognize speech. Try again.';
      elements.feedback.style.color = '#ff6b6b';
      
      setTimeout(() => {
        elements.feedback.textContent = '';
      }, 2000);
    }

    // Start/stop recording
    function toggleRecording() {
      if (!speechSupported || !speechRecognition) {
        elements.feedback.textContent = 'Speech recognition not supported';
        return;
      }
      
      if (!isRecording) {
        isRecording = true;
        elements.recordBtn.classList.add('recording');
        elements.recordBtn.innerHTML = 'ðŸ›‘';
        elements.feedback.textContent = 'Listening... Speak now!';
        elements.feedback.style.color = '#54a0ff';
        
        try {
          speechRecognition.start();
        } catch (e) {
          console.error('Speech recognition start error:', e);
          isRecording = false;
          elements.recordBtn.classList.remove('recording');
          elements.recordBtn.innerHTML = 'ðŸŽ¤';
          elements.feedback.textContent = 'Error starting speech recognition';
        }
      } else {
        speechRecognition.stop();
      }
    }

    // Calculate Levenshtein distance for fuzzy string matching
    function levenshteinDistance(str1, str2) {
      const matrix = [];
      for (let i = 0; i <= str2.length; i++) {
        matrix[i] = [i];
      }
      for (let j = 0; j <= str1.length; j++) {
        matrix[0][j] = j;
      }
      for (let i = 1; i <= str2.length; i++) {
        for (let j = 1; j <= str1.length; j++) {
          if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
            matrix[i][j] = matrix[i - 1][j - 1];
          } else {
            matrix[i][j] = Math.min(
              matrix[i - 1][j - 1] + 1,
              matrix[i][j - 1] + 1,
              matrix[i - 1][j] + 1
            );
          }
        }
      }
      return matrix[str2.length][str1.length];
    }

    // Move to next word
    function nextWord() {
      currentIndex = (currentIndex + 1) % shuffledWords.length;
      
      // Reshuffle when we've gone through all words
      if (currentIndex === 0) {
        shuffledWords = [...words].sort(() => Math.random() - 0.5);
      }
      
      elements.feedback.textContent = '';
      updateWord();
    }

    // Skip current word
    function skipWord() {
      elements.feedback.textContent = 'Skipped! ðŸ”„';
      elements.feedback.style.color = '#feca57';
      setTimeout(() => {
        elements.feedback.textContent = '';
        nextWord();
      }, 800);
    }

    // Event listeners
    elements.listenBtn.onclick = speakWord;
    elements.recordBtn.onclick = toggleRecording;

    // Load voices when available
    if ('speechSynthesis' in window) {
      speechSynthesis.onvoiceschanged = () => {
        // Voices are now loaded
      };
    }

    // Initialize app when page loads
    init();

    // Make functions globally available
    window.setModule = setModule;
    window.skipWord = skipWord;
  </script>
</body>
</html>
